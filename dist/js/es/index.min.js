class t{enterFullScreen(){document.fullscreenElement||document.documentElement.requestFullscreen({navigationUI:"hide"})}exitFullScreen(){document.exitFullscreen&&document.exitFullscreen()}addFullScreenListener(t){document.addEventListener("fullscreenchange",t,!1)}isFullScreen(){return!!document.fullscreenElement}}class e{static async load(t){return(await fetch(t)).arrayBuffer()}}class i{static load(t,e,i=e.LINEAR,r=e.LINEAR,o=!1){return new Promise(((n,s)=>{const a=e.createTexture();if(null===a)return void s("Error creating WebGL texture");const l=new Image;l.src=t,l.onload=()=>{e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),!0===o?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)),e.bindTexture(e.TEXTURE_2D,null),l&&l.src&&console.log(`Loaded texture ${t} [${l.width}x${l.height}]`),n(a)},l.onerror=()=>s("Cannot load image")}))}static async loadCubemap(t,e,i="png"){const r=e.createTexture();if(null===r)throw new Error("Error creating WebGL texture");e.bindTexture(e.TEXTURE_CUBE_MAP,r),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.NEAREST);const o=[{type:e.TEXTURE_CUBE_MAP_POSITIVE_X,suffix:`-posx.${i}`},{type:e.TEXTURE_CUBE_MAP_NEGATIVE_X,suffix:`-negx.${i}`},{type:e.TEXTURE_CUBE_MAP_POSITIVE_Y,suffix:`-posy.${i}`},{type:e.TEXTURE_CUBE_MAP_NEGATIVE_Y,suffix:`-negy.${i}`},{type:e.TEXTURE_CUBE_MAP_POSITIVE_Z,suffix:`-posz.${i}`},{type:e.TEXTURE_CUBE_MAP_NEGATIVE_Z,suffix:`-negz.${i}`}].map((i=>new Promise(((o,n)=>{const s=new Image;s.src=t+i.suffix,s.onload=()=>{e.bindTexture(e.TEXTURE_CUBE_MAP,r),e.texImage2D(i.type,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,s),s&&s.src&&console.log(`Loaded texture ${t}${i.suffix} [${s.width}x${s.height}]`),o()},s.onerror=()=>n("Cannot load image")}))));return await Promise.all(o),e.bindTexture(e.TEXTURE_2D,null),r}}class r{constructor(){this.numIndices=0}loadBuffer(t,e,i,r){var o=new Uint8Array(r,0,r.byteLength);t.bindBuffer(i,e),t.bufferData(i,o,t.STATIC_DRAW)}async load(t,i){const[r,o]=await Promise.all([e.load(`${t}-indices.bin`),e.load(`${t}-strides.bin`)]);console.log(`Loaded ${t}-indices.bin (${r.byteLength} bytes)`),console.log(`Loaded ${t}-strides.bin (${o.byteLength} bytes)`),this.bufferIndices=i.createBuffer(),this.loadBuffer(i,this.bufferIndices,i.ELEMENT_ARRAY_BUFFER,r),this.numIndices=r.byteLength/2/3,this.bufferStrides=i.createBuffer(),this.loadBuffer(i,this.bufferStrides,i.ARRAY_BUFFER,o)}bindBuffers(t){t.bindBuffer(t.ARRAY_BUFFER,this.bufferStrides),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.bufferIndices)}getNumIndices(){return this.numIndices}}class o{constructor(t){this.gl=t,this.vertexShaderCode="",this.fragmentShaderCode="",this.fillCode(),this.initShader()}getShader(t,e){const i=this.gl.createShader(t);if(i){if(this.gl.shaderSource(i,e),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))return i;console.warn(this.gl.getShaderInfoLog(i))}else console.warn("Error creating shader.")}getUniform(t){if(void 0===this.program)throw new Error("No program for shader.");const e=this.gl.getUniformLocation(this.program,t);if(null!==e)return e;throw new Error(`Cannot get uniform "${t}".`)}getAttrib(t){if(void 0===this.program)throw new Error("No program for shader.");return this.gl.getAttribLocation(this.program,t)}initShader(){const t=this.getShader(this.gl.FRAGMENT_SHADER,this.fragmentShaderCode),e=this.getShader(this.gl.VERTEX_SHADER,this.vertexShaderCode),i=this.gl.createProgram();void 0!==t&&void 0!==e&&null!==i&&(this.gl.attachShader(i,e),this.gl.attachShader(i,t),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?console.log(this.constructor.name+": Initialised shader"):console.warn(this.constructor.name+": Could not initialise shader"),this.gl.useProgram(i),this.program=i,this.fillUniformsAttributes())}use(){this.program&&this.gl.useProgram(this.program)}deleteProgram(){this.program&&this.gl.deleteProgram(this.program)}}var n=1e-6,s="undefined"!=typeof Float32Array?Float32Array:Array;function a(){var t=new s(16);return s!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function l(t,e,i){var r=e[0],o=e[1],n=e[2],s=e[3],a=e[4],l=e[5],h=e[6],d=e[7],c=e[8],u=e[9],m=e[10],_=e[11],f=e[12],p=e[13],g=e[14],v=e[15],b=i[0],x=i[1],A=i[2],w=i[3];return t[0]=b*r+x*a+A*c+w*f,t[1]=b*o+x*l+A*u+w*p,t[2]=b*n+x*h+A*m+w*g,t[3]=b*s+x*d+A*_+w*v,b=i[4],x=i[5],A=i[6],w=i[7],t[4]=b*r+x*a+A*c+w*f,t[5]=b*o+x*l+A*u+w*p,t[6]=b*n+x*h+A*m+w*g,t[7]=b*s+x*d+A*_+w*v,b=i[8],x=i[9],A=i[10],w=i[11],t[8]=b*r+x*a+A*c+w*f,t[9]=b*o+x*l+A*u+w*p,t[10]=b*n+x*h+A*m+w*g,t[11]=b*s+x*d+A*_+w*v,b=i[12],x=i[13],A=i[14],w=i[15],t[12]=b*r+x*a+A*c+w*f,t[13]=b*o+x*l+A*u+w*p,t[14]=b*n+x*h+A*m+w*g,t[15]=b*s+x*d+A*_+w*v,t}function h(){var t=new s(3);return s!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function d(t,e,i){var r=new s(3);return r[0]=t,r[1]=e,r[2]=i,r}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function c(){var t=new s(4);return s!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}h(),function(){var t,e=(t=new s(4),s!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var u;h(),d(1,0,0),d(0,1,0),c(),c(),u=new s(9),s!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,function(){var t=function(){var t=new s(2);return s!=Float32Array&&(t[0]=0,t[1]=0),t}()}();class m{constructor(){this.mMMatrix=a(),this.mVMatrix=a(),this.mMVPMatrix=a(),this.mProjMatrix=a(),this.matOrtho=a(),this.m_boundTick=this.tick.bind(this),this.isWebGL2=!1,this.viewportWidth=0,this.viewportHeight=0}get gl(){if(void 0===this.m_gl)throw new Error("No WebGL context");return this.m_gl}logGLError(){var t=this.gl.getError();t!==this.gl.NO_ERROR&&console.warn(`WebGL error # + ${t}`)}setTexture2D(t,e,i){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(i,t)}setTextureCubemap(t,e,i){this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,e),this.gl.uniform1i(i,t)}setFOV(t,e,i,r,o){const n=Math.tan(e/360*Math.PI)*r,s=n*i;!function(t,e,i,r,o,n,s){var a=1/(i-e),l=1/(o-r),h=1/(n-s);t[0]=2*n*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(o+r)*l,t[10]=(s+n)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*n*2*h,t[15]=0}(t,-s,s,-n,n,r,o)}calculateMVPMatrix(t,e,i,r,o,s,a,h,d){!function(t){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this.mMMatrix),function(t,e,i,r){var o,s,a,l,h,d,c,u,m,_,f,p,g,v,b,x,A,w,E,C,y,T,S,M,P=r[0],R=r[1],D=r[2],O=Math.hypot(P,R,D);O<n||(P*=O=1/O,R*=O,D*=O,o=Math.sin(i),a=1-(s=Math.cos(i)),l=e[0],h=e[1],d=e[2],c=e[3],u=e[4],m=e[5],_=e[6],f=e[7],p=e[8],g=e[9],v=e[10],b=e[11],x=P*P*a+s,A=R*P*a+D*o,w=D*P*a-R*o,E=P*R*a-D*o,C=R*R*a+s,y=D*R*a+P*o,T=P*D*a+R*o,S=R*D*a-P*o,M=D*D*a+s,t[0]=l*x+u*A+p*w,t[1]=h*x+m*A+g*w,t[2]=d*x+_*A+v*w,t[3]=c*x+f*A+b*w,t[4]=l*E+u*C+p*y,t[5]=h*E+m*C+g*y,t[6]=d*E+_*C+v*y,t[7]=c*E+f*C+b*y,t[8]=l*T+u*S+p*M,t[9]=h*T+m*S+g*M,t[10]=d*T+_*S+v*M,t[11]=c*T+f*S+b*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this.mMMatrix,this.mMMatrix,0,[1,0,0]),function(t,e,i){var r,o,n,s,a,l,h,d,c,u,m,_,f=i[0],p=i[1],g=i[2];e===t?(t[12]=e[0]*f+e[4]*p+e[8]*g+e[12],t[13]=e[1]*f+e[5]*p+e[9]*g+e[13],t[14]=e[2]*f+e[6]*p+e[10]*g+e[14],t[15]=e[3]*f+e[7]*p+e[11]*g+e[15]):(r=e[0],o=e[1],n=e[2],s=e[3],a=e[4],l=e[5],h=e[6],d=e[7],c=e[8],u=e[9],m=e[10],_=e[11],t[0]=r,t[1]=o,t[2]=n,t[3]=s,t[4]=a,t[5]=l,t[6]=h,t[7]=d,t[8]=c,t[9]=u,t[10]=m,t[11]=_,t[12]=r*f+a*p+c*g+e[12],t[13]=o*f+l*p+u*g+e[13],t[14]=n*f+h*p+m*g+e[14],t[15]=s*f+d*p+_*g+e[15])}(this.mMMatrix,this.mMMatrix,[t,e,i]),function(t,e,i){var r=i[0],o=i[1],n=i[2];t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this.mMMatrix,this.mMMatrix,[a,h,d]),function(t,e,i){var r=Math.sin(i),o=Math.cos(i),n=e[4],s=e[5],a=e[6],l=e[7],h=e[8],d=e[9],c=e[10],u=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*o+h*r,t[5]=s*o+d*r,t[6]=a*o+c*r,t[7]=l*o+u*r,t[8]=h*o-n*r,t[9]=d*o-s*r,t[10]=c*o-a*r,t[11]=u*o-l*r}(this.mMMatrix,this.mMMatrix,r),function(t,e,i){var r=Math.sin(i),o=Math.cos(i),n=e[0],s=e[1],a=e[2],l=e[3],h=e[8],d=e[9],c=e[10],u=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*o-h*r,t[1]=s*o-d*r,t[2]=a*o-c*r,t[3]=l*o-u*r,t[8]=n*r+h*o,t[9]=s*r+d*o,t[10]=a*r+c*o,t[11]=l*r+u*o}(this.mMMatrix,this.mMMatrix,o),function(t,e,i){var r=Math.sin(i),o=Math.cos(i),n=e[0],s=e[1],a=e[2],l=e[3],h=e[4],d=e[5],c=e[6],u=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*o+h*r,t[1]=s*o+d*r,t[2]=a*o+c*r,t[3]=l*o+u*r,t[4]=h*o-n*r,t[5]=d*o-s*r,t[6]=c*o-a*r,t[7]=u*o-l*r}(this.mMMatrix,this.mMMatrix,s),l(this.mMVPMatrix,this.mVMatrix,this.mMMatrix),l(this.mMVPMatrix,this.mProjMatrix,this.mMVPMatrix)}drawScene(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}tick(){requestAnimationFrame(this.m_boundTick),this.resizeCanvas(),this.drawScene(),this.animate()}initGL(t){const e=t.getContext("webgl",{alpha:!1});if(null===e)throw new Error("Cannot initialize WebGL context");return e}initGL2(t){let e=t.getContext("webgl2",{alpha:!1});return null===e?(console.warn("Could not initialise WebGL 2, falling back to WebGL 1"),this.initGL(t)):e}generateMipmaps(...t){for(const e of t)this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR),this.gl.generateMipmap(this.gl.TEXTURE_2D)}init(t,e=!1){if(this.onBeforeInit(),this.canvas=document.getElementById(t),null===this.canvas)throw new Error("Cannot find canvas element");this.viewportWidth=this.canvas.width,this.viewportHeight=this.canvas.height,this.m_gl=e?this.initGL2(this.canvas):this.initGL(this.canvas),this.m_gl?(this.resizeCanvas(),this.onAfterInit(),this.initShaders(),this.loadData(),this.m_boundTick()):this.onInitError()}resizeCanvas(){if(void 0===this.canvas)return;const t=window.devicePixelRatio||1,e=Math.floor(this.canvas.clientWidth*t),i=Math.floor(this.canvas.clientHeight*t);this.canvas.width==e&&this.canvas.height==i||(this.canvas.width=e,this.canvas.height=i)}checkGlError(t){let e;for(;(e=this.gl.getError())!==this.gl.NO_ERROR;)console.error(`${t}: glError ${e}`)}unbindBuffers(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}getMVPMatrix(){return this.mMVPMatrix}getOrthoMatrix(){return this.matOrtho}getModelMatrix(){return this.mMMatrix}getViewMatrix(){return this.mVMatrix}}class _ extends o{fillCode(){this.vertexShaderCode="uniform mat4 view_proj_matrix;\nattribute vec4 rm_Vertex;\nattribute vec2 rm_TexCoord0;\nvarying vec2 vTextureCoord;\n\nvoid main() {\n  gl_Position = view_proj_matrix * rm_Vertex;\n  vTextureCoord = rm_TexCoord0;\n}",this.fragmentShaderCode="precision mediump float;\nvarying vec2 vTextureCoord;\nuniform sampler2D sTexture;\n\nvoid main() {\n  gl_FragColor = texture2D(sTexture, vTextureCoord);\n}"}fillUniformsAttributes(){this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.rm_Vertex=this.getAttrib("rm_Vertex"),this.rm_TexCoord0=this.getAttrib("rm_TexCoord0"),this.sTexture=this.getUniform("sTexture")}drawModel(t,e,i,r,o,n,s,a,l,h,d,c){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix)return;const u=t.gl;if(e.bindBuffers(u),u.enableVertexAttribArray(this.rm_Vertex),u.enableVertexAttribArray(this.rm_TexCoord0),c)for(const[t,e]of c)u.vertexAttribPointer(t,...e);else u.vertexAttribPointer(this.rm_Vertex,3,u.FLOAT,!1,20,0),u.vertexAttribPointer(this.rm_TexCoord0,2,u.FLOAT,!1,20,12);t.calculateMVPMatrix(i,r,o,n,s,a,l,h,d),u.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),u.drawElements(u.TRIANGLES,3*e.getNumIndices(),u.UNSIGNED_SHORT,0),t.checkGlError("DiffuseShader glDrawElements")}}var f,p=1e-6,g="undefined"!=typeof Float32Array?Float32Array:Array;function v(){var t=new g(16);return g!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function b(t){var e=new g(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function x(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function A(t,e){var i=e[0],r=e[1],o=e[2],n=e[3],s=e[4],a=e[5],l=e[6],h=e[7],d=e[8],c=e[9],u=e[10],m=e[11],_=e[12],f=e[13],p=e[14],g=e[15],v=i*a-r*s,b=i*l-o*s,x=i*h-n*s,A=r*l-o*a,w=r*h-n*a,E=o*h-n*l,C=d*f-c*_,y=d*p-u*_,T=d*g-m*_,S=c*p-u*f,M=c*g-m*f,P=u*g-m*p,R=v*P-b*M+x*S+A*T-w*y+E*C;return R?(R=1/R,t[0]=(a*P-l*M+h*S)*R,t[1]=(o*M-r*P-n*S)*R,t[2]=(f*E-p*w+g*A)*R,t[3]=(u*w-c*E-m*A)*R,t[4]=(l*T-s*P-h*y)*R,t[5]=(i*P-o*T+n*y)*R,t[6]=(p*x-_*E-g*b)*R,t[7]=(d*E-u*x+m*b)*R,t[8]=(s*M-a*T+h*C)*R,t[9]=(r*T-i*M-n*C)*R,t[10]=(_*w-f*x+g*v)*R,t[11]=(c*x-d*w-m*v)*R,t[12]=(a*y-s*S-l*C)*R,t[13]=(i*S-r*y+o*C)*R,t[14]=(f*b-_*A-p*v)*R,t[15]=(d*A-c*b+u*v)*R,t):null}function w(t,e,i){var r=e[0],o=e[1],n=e[2],s=e[3],a=e[4],l=e[5],h=e[6],d=e[7],c=e[8],u=e[9],m=e[10],_=e[11],f=e[12],p=e[13],g=e[14],v=e[15],b=i[0],x=i[1],A=i[2],w=i[3];return t[0]=b*r+x*a+A*c+w*f,t[1]=b*o+x*l+A*u+w*p,t[2]=b*n+x*h+A*m+w*g,t[3]=b*s+x*d+A*_+w*v,b=i[4],x=i[5],A=i[6],w=i[7],t[4]=b*r+x*a+A*c+w*f,t[5]=b*o+x*l+A*u+w*p,t[6]=b*n+x*h+A*m+w*g,t[7]=b*s+x*d+A*_+w*v,b=i[8],x=i[9],A=i[10],w=i[11],t[8]=b*r+x*a+A*c+w*f,t[9]=b*o+x*l+A*u+w*p,t[10]=b*n+x*h+A*m+w*g,t[11]=b*s+x*d+A*_+w*v,b=i[12],x=i[13],A=i[14],w=i[15],t[12]=b*r+x*a+A*c+w*f,t[13]=b*o+x*l+A*u+w*p,t[14]=b*n+x*h+A*m+w*g,t[15]=b*s+x*d+A*_+w*v,t}function E(t,e,i){var r,o,n,s,a,l,h,d,c,u,m,_,f=i[0],p=i[1],g=i[2];return e===t?(t[12]=e[0]*f+e[4]*p+e[8]*g+e[12],t[13]=e[1]*f+e[5]*p+e[9]*g+e[13],t[14]=e[2]*f+e[6]*p+e[10]*g+e[14],t[15]=e[3]*f+e[7]*p+e[11]*g+e[15]):(r=e[0],o=e[1],n=e[2],s=e[3],a=e[4],l=e[5],h=e[6],d=e[7],c=e[8],u=e[9],m=e[10],_=e[11],t[0]=r,t[1]=o,t[2]=n,t[3]=s,t[4]=a,t[5]=l,t[6]=h,t[7]=d,t[8]=c,t[9]=u,t[10]=m,t[11]=_,t[12]=r*f+a*p+c*g+e[12],t[13]=o*f+l*p+u*g+e[13],t[14]=n*f+h*p+m*g+e[14],t[15]=s*f+d*p+_*g+e[15]),t}function C(t,e,i){var r=Math.sin(i),o=Math.cos(i),n=e[4],s=e[5],a=e[6],l=e[7],h=e[8],d=e[9],c=e[10],u=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*o+h*r,t[5]=s*o+d*r,t[6]=a*o+c*r,t[7]=l*o+u*r,t[8]=h*o-n*r,t[9]=d*o-s*r,t[10]=c*o-a*r,t[11]=u*o-l*r,t}function y(t,e,i){var r=Math.sin(i),o=Math.cos(i),n=e[0],s=e[1],a=e[2],l=e[3],h=e[8],d=e[9],c=e[10],u=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*o-h*r,t[1]=s*o-d*r,t[2]=a*o-c*r,t[3]=l*o-u*r,t[8]=n*r+h*o,t[9]=s*r+d*o,t[10]=a*r+c*o,t[11]=l*r+u*o,t}function T(t,e,i){var r=Math.sin(i),o=Math.cos(i),n=e[0],s=e[1],a=e[2],l=e[3],h=e[4],d=e[5],c=e[6],u=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*o+h*r,t[1]=s*o+d*r,t[2]=a*o+c*r,t[3]=l*o+u*r,t[4]=h*o-n*r,t[5]=d*o-s*r,t[6]=c*o-a*r,t[7]=u*o-l*r,t}function S(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function M(){var t=new g(3);return g!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function P(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function R(t,e){var i=e[0],r=e[1],o=e[2],n=i*i+r*r+o*o;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),function(){var t=M()}(),function(t){t[t.Rotating=0]="Rotating",t[t.Fixed=1]="Fixed"}(f||(f={}));class D extends _{fillCode(){this.vertexShaderCode="#version 300 es\n            precision highp float;\n            uniform vec4 lightDir;\n            uniform vec4 lightDir2;\n            uniform mat4 view_matrix;\n            uniform mat4 model_matrix;\n            uniform mat4 view_proj_matrix;\n\n            in float rm_TexCoord0;\n            in vec4 rm_Vertex;\n            in vec3 rm_Normal;\n\n            out vec4 vTexAndColors; // xy = texture coord; z = color coeff 1, w = color coeff 2\n\n            void main(void) {\n               gl_Position = view_proj_matrix * rm_Vertex;\n\n               vec3 vLightVec = -(view_matrix * lightDir).xyz;\n               vec3 vLightVec2 = -(view_matrix * lightDir2).xyz;\n               vec4 normal = model_matrix * vec4(rm_Normal, 0.0);\n               vec3 vNormal = normalize(view_matrix * normal).xyz;\n\n               float c1 = max(0.05, dot(vNormal, normalize(vLightVec)));\n               float c2 = max(0.05, dot(vNormal, normalize(vLightVec2)));\n\n               vTexAndColors = vec4(rm_TexCoord0, 0.5, c1, c2);\n            }",this.fragmentShaderCode="#version 300 es\n            precision mediump float;\n\n            uniform sampler2D sTexture;\n            uniform vec4 diffuse;\n            uniform vec4 ambient;\n            uniform vec4 ambient2;\n            uniform float diffuseCoef;\n            uniform float diffuseCoef2;\n            uniform float diffuseExponent;\n\n            in vec4 vTexAndColors;\n\n            out vec4 fragColor;\n\n            void main(void) {\n               vec2 vTexCoord = vTexAndColors.xy;\n               float c1 = vTexAndColors.z;\n               float c2 = vTexAndColors.w;\n\n               float d1 = pow(c1 * diffuseCoef, diffuseExponent);\n               d1 = clamp(d1, 0.0, 1.0);\n               float d2 = pow(c2 * diffuseCoef2, diffuseExponent);\n               d2 = clamp(d2, 0.0, 1.0);\n               vec4 vDiffuseColor = mix(diffuse, ambient, d1);\n               vDiffuseColor = mix(vDiffuseColor, ambient2, d2);\n               fragColor = vDiffuseColor * textureLod(sTexture, vTexCoord, 0.0);\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.view_matrix=this.getUniform("view_matrix"),this.model_matrix=this.getUniform("model_matrix"),this.rm_Normal=this.getAttrib("rm_Normal"),this.ambient=this.getUniform("ambient"),this.ambient2=this.getUniform("ambient2"),this.diffuse=this.getUniform("diffuse"),this.lightDir=this.getUniform("lightDir"),this.lightDir2=this.getUniform("lightDir2"),this.diffuseCoef=this.getUniform("diffuseCoef"),this.diffuseCoef2=this.getUniform("diffuseCoef2"),this.diffuseExponent=this.getUniform("diffuseExponent")}drawModel(t,e,i,r,o,n,s,a,l,h,d){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.rm_Normal||void 0===this.view_proj_matrix||void 0===this.view_matrix||void 0===this.model_matrix)return;const c=t.gl;e.bindBuffers(c),c.enableVertexAttribArray(this.rm_Vertex),c.enableVertexAttribArray(this.rm_TexCoord0),c.enableVertexAttribArray(this.rm_Normal),c.vertexAttribPointer(this.rm_Vertex,3,c.HALF_FLOAT,!1,12,0),c.vertexAttribPointer(this.rm_TexCoord0,1,c.UNSIGNED_BYTE,!0,12,6),c.vertexAttribPointer(this.rm_Normal,3,c.BYTE,!0,12,7),t.calculateMVPMatrix(i,r,o,n,s,a,l,h,d),c.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),c.uniformMatrix4fv(this.view_matrix,!1,t.getViewMatrix()),c.uniformMatrix4fv(this.model_matrix,!1,t.getModelMatrix()),c.drawElements(c.TRIANGLES,3*e.getNumIndices(),c.UNSIGNED_SHORT,0),t.checkGlError("PlaneBodyLitShader glDrawElements")}}class O extends o{constructor(){super(...arguments),this._color=[1,1,0,0]}fillCode(){this.vertexShaderCode="precision highp float;\n        attribute vec4 rm_Vertex;\n        uniform mat4 view_proj_matrix;\n        void main() {\n            gl_Position = view_proj_matrix * rm_Vertex;\n        }",this.fragmentShaderCode="precision mediump float;\n        uniform vec4 color;\n\n        void main() {\n            gl_FragColor = color;\n        }"}setColor(t,e,i,r){this._color=[t,e,i,r]}fillUniformsAttributes(){this.rm_Vertex=this.getAttrib("rm_Vertex"),this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.color=this.getUniform("color")}drawModel(t,e,i,r,o,n,s,a,l,h,d){if(void 0===this.rm_Vertex||void 0===this.view_proj_matrix||void 0===this.color)return;const c=t.gl;e.bindBuffers(c),c.enableVertexAttribArray(this.rm_Vertex),c.vertexAttribPointer(this.rm_Vertex,3,c.FLOAT,!1,12,0),t.calculateMVPMatrix(i,r,o,n,s,a,l,h,d),c.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),c.uniform4f(this.color,this._color[0],this._color[1],this._color[2],this._color[3]),c.drawElements(c.TRIANGLES,3*e.getNumIndices(),c.UNSIGNED_SHORT,0),t.checkGlError("ColorShader glDrawElements")}drawModelWithoutTransform(t,e,i){if(void 0===this.rm_Vertex||void 0===this.view_proj_matrix||void 0===this.color)return;const r=t.gl;if(e.bindBuffers(r),r.enableVertexAttribArray(this.rm_Vertex),i)for(const[t,e]of i)r.vertexAttribPointer(t,...e);else r.vertexAttribPointer(this.rm_Vertex,3,r.FLOAT,!1,12,0);r.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),r.uniform4f(this.color,this._color[0],this._color[1],this._color[2],this._color[3]),r.drawElements(r.TRIANGLES,3*e.getNumIndices(),r.UNSIGNED_SHORT,0),t.checkGlError("ColorShader glDrawElements")}}class L extends _{constructor(){super(...arguments),this._color1=[1,1,0,0],this._color2=[1,1,0,0]}fillCode(){super.fillCode(),this.fragmentShaderCode="precision mediump float;\n            varying vec2 vTextureCoord;\n            uniform sampler2D sTexture;\n            uniform vec4 color1;\n            uniform vec4 color2;\n\n            void main() {\n                gl_FragColor = mix(color1, color2, texture2D(sTexture, vTextureCoord)[0]);\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.color1=this.getUniform("color1"),this.color2=this.getUniform("color2")}setColor1(t,e,i,r){this._color1=[t,e,i,r]}setColor2(t,e,i,r){this._color2=[t,e,i,r]}drawModel(t,e,i,r,o,n,s,a,l,h,d){if(void 0===this.rm_Vertex||void 0===this.view_proj_matrix||void 0===this.color1||void 0===this.color2)return;const c=t.gl;c.uniform4f(this.color1,this._color1[0],this._color1[1],this._color1[2],this._color1[3]),c.uniform4f(this.color2,this._color2[0],this._color2[1],this._color2[2],this._color2[3]),super.drawModel(t,e,i,r,o,n,s,a,l,h,d)}}class F extends L{fillCode(){super.fillCode(),this.fragmentShaderCode="precision mediump float;\n            varying vec2 vTextureCoord;\n            uniform sampler2D sTexture;\n            uniform vec4 color1;\n            uniform vec4 color2;\n            uniform vec2 uBrightnessContrast;\n\n            void main() {\n                float a = texture2D(sTexture, vTextureCoord)[0];\n                a = (a - uBrightnessContrast.x) * uBrightnessContrast.y;\n                a = clamp(a, 0.0, 1.0);\n                gl_FragColor = mix(color2, color1, a);\n            }"}fillUniformsAttributes(){super.fillUniformsAttributes(),this.uBrightnessContrast=this.getUniform("uBrightnessContrast")}}class N extends o{constructor(){super(...arguments),this._color=[1,1,0,0],this._time=0}fillCode(){this.vertexShaderCode="precision highp float;\n        attribute vec4 rm_Vertex;\n        attribute float rm_TexCoord0;\n        uniform mat4 view_proj_matrix;\n        uniform float uTime;\n\n        const float NOISE_AMPLITUDE = 750.;\n        const float NOISE_SCALE = 80.0;\n\n        void main() {\n            vec4 vertex = rm_Vertex;\n            float offset = sin(rm_TexCoord0 * NOISE_SCALE + uTime * 0.001);\n            vertex.z += offset * NOISE_AMPLITUDE * uTime;\n            gl_Position = view_proj_matrix * vertex;\n        }",this.fragmentShaderCode="precision mediump float;\n        uniform vec4 color;\n\n        void main() {\n            gl_FragColor = color;\n        }"}setColor(t,e,i,r){this._color=[t,e,i,r]}setTime(t){this._time=t}fillUniformsAttributes(){this.rm_Vertex=this.getAttrib("rm_Vertex"),this.rm_TexCoord0=this.getAttrib("rm_TexCoord0"),this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.color=this.getUniform("color"),this.time=this.getUniform("uTime")}drawModel(t,e,i,r,o,n,s,a,l,h,d){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix||void 0===this.color||void 0===this.time)return;const c=t.gl;e.bindBuffers(c),c.enableVertexAttribArray(this.rm_Vertex),c.enableVertexAttribArray(this.rm_TexCoord0),c.vertexAttribPointer(this.rm_Vertex,3,c.FLOAT,!1,16,0),c.vertexAttribPointer(this.rm_TexCoord0,1,c.UNSIGNED_BYTE,!0,16,12),t.calculateMVPMatrix(i,r,o,n,s,a,l,h,d),c.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),c.uniform4f(this.color,this._color[0],this._color[1],this._color[2],this._color[3]),c.uniform1f(this.time,this._time),c.drawElements(c.TRIANGLES,3*e.getNumIndices(),c.UNSIGNED_SHORT,0),t.checkGlError("CloudShader glDrawElements")}}class I extends o{constructor(){super(...arguments),this._color=[1,1,0,0]}fillCode(){this.vertexShaderCode="precision highp float;\n        attribute vec4 rm_Vertex;\n        attribute vec2 rm_TexCoord0;\n        uniform mat4 view_proj_matrix;\n        uniform mediump vec4 color;\n        varying mediump vec4 vColor;\n\n        void main() {\n            vColor = color;\n            vColor.a = rm_TexCoord0.x;\n            gl_Position = view_proj_matrix * rm_Vertex;\n        }",this.fragmentShaderCode="precision mediump float;\n        varying vec4 vColor;\n\n        void main() {\n            gl_FragColor = vColor;\n        }"}setColor(t,e,i,r){this._color=[t,e,i,r]}fillUniformsAttributes(){this.rm_Vertex=this.getAttrib("rm_Vertex"),this.rm_TexCoord0=this.getAttrib("rm_TexCoord0"),this.view_proj_matrix=this.getUniform("view_proj_matrix"),this.color=this.getUniform("color")}drawModel(t,e,i,r,o,n,s,a,l,h,d){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix||void 0===this.color)return;const c=t.gl;e.bindBuffers(c),c.enableVertexAttribArray(this.rm_Vertex),c.enableVertexAttribArray(this.rm_TexCoord0),c.vertexAttribPointer(this.rm_Vertex,3,c.FLOAT,!1,20,0),c.vertexAttribPointer(this.rm_TexCoord0,2,c.FLOAT,!1,20,12),t.calculateMVPMatrix(i,r,o,n,s,a,l,h,d),c.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),c.uniform4f(this.color,this._color[0],this._color[1],this._color[2],this._color[3]),c.drawElements(c.TRIANGLES,3*e.getNumIndices(),c.UNSIGNED_SHORT,0),t.checkGlError("PlaneTrracesShader glDrawElements")}drawModelWithoutTransform(t,e){if(void 0===this.rm_Vertex||void 0===this.rm_TexCoord0||void 0===this.view_proj_matrix||void 0===this.color)return;const i=t.gl;e.bindBuffers(i),i.enableVertexAttribArray(this.rm_Vertex),i.enableVertexAttribArray(this.rm_TexCoord0),i.vertexAttribPointer(this.rm_Vertex,3,i.FLOAT,!1,20,0),i.vertexAttribPointer(this.rm_TexCoord0,2,i.FLOAT,!1,20,12),i.uniformMatrix4fv(this.view_proj_matrix,!1,t.getMVPMatrix()),i.uniform4f(this.color,this._color[0],this._color[1],this._color[2],this._color[3]),i.drawElements(i.TRIANGLES,3*e.getNumIndices(),i.UNSIGNED_SHORT,0),t.checkGlError("PlaneTrracesShader glDrawElements")}}class k{constructor(){this._speed=0,this.duration=0,this._minDuration=3e3,this._timer=0,this.lastTime=0,this._reverse=!1,this._cameraPosition=M(),this._cameraRotation=M(),this._matrix=v()}get cameraPosition(){return this._cameraPosition}get cameraRotation(){return this._cameraRotation}get reverse(){return this._reverse}set reverse(t){this._reverse=t}set minDuration(t){this._minDuration=t}get matrix(){return this._matrix}get speed(){return this._speed}set speed(t){this._speed=t}get position(){return this._position}set position(t){this._position=t,this.duration=Math.max(this.getLength()/this.speed,this._minDuration)}get timer(){return this._timer}set timer(t){this._timer=t,this.updateMatrix()}getLength(){if(void 0===this.position)return 0;const t=this.position.start.position,e=this.position.end.position;return Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2+(e[2]-t[2])**2)}iterate(t){if(0!=this.lastTime){const e=t-this.lastTime;this._timer+=e/this.duration,this._timer>1&&(this._timer=1)}this.lastTime=t,this.updateMatrix()}reset(){this._timer=0,this.updateMatrix()}updateMatrix(){if(void 0===this._position)return;const t=this._reverse?this._position.end:this._position.start,e=this._reverse?this._position.start:this._position.end;this._cameraPosition[0]=t.position[0]+this._timer*(e.position[0]-t.position[0]),this._cameraPosition[1]=t.position[1]+this._timer*(e.position[1]-t.position[1]),this._cameraPosition[2]=t.position[2]+this._timer*(e.position[2]-t.position[2]),this._cameraRotation[0]=t.rotation[0]+this._timer*(e.rotation[0]-t.rotation[0]),this._cameraRotation[1]=t.rotation[1]+this._timer*(e.rotation[1]-t.rotation[1]),this._cameraRotation[2]=t.rotation[2]+this._timer*(e.rotation[2]-t.rotation[2]),x(this.matrix),C(this.matrix,this.matrix,this._cameraRotation[0]-Math.PI/2),T(this.matrix,this.matrix,this._cameraRotation[1]),y(this.matrix,this.matrix,this._cameraRotation[2]),E(this.matrix,this.matrix,[-this._cameraPosition[0],-this._cameraPosition[1],-this._cameraPosition[2]])}}const U=[[{name:"CAM1 right side",start:{position:new Float32Array([-7833.58,1685.874,2205.098]),rotation:new Float32Array([-892.116,1634.487,675.177])},end:{position:new Float32Array([-7852.91,-1940.758,2239.207]),rotation:new Float32Array([-911.445,-1992.145,709.2865])},speedMultiplier:1},{name:"CAM3 top",start:{position:new Float32Array([-792.257,1444,15e3]),rotation:new Float32Array([37.385,1444,675.177])},end:{position:new Float32Array([-811.587,-2182.632,15e3]),rotation:new Float32Array([18.056,-2182.631,709.286])},speedMultiplier:1},{name:"CAM4 rear-right",start:{position:new Float32Array([-5114,9242,3773]),rotation:new Float32Array([831.674,794.416,582.775])},end:{position:new Float32Array([-9523.469,5923.208,3257.0854]),rotation:new Float32Array([-328.607,-121.523,689.812])},speedMultiplier:1},{name:"CAM1 right side again",start:{position:new Float32Array([-7833.58,1685.874,2205.098]),rotation:new Float32Array([-892.116,1634.487,675.177])},end:{position:new Float32Array([-7852.91,-1940.758,2239.207]),rotation:new Float32Array([-911.445,-1992.145,709.2865])},speedMultiplier:1},{name:"CAM2 front",start:{position:new Float32Array([-2215.693,-9555,555]),rotation:new Float32Array([-2215.693,-3240,555])},end:{position:new Float32Array([1741.289,-9555,555]),rotation:new Float32Array([1741.289,-3240,555])},speedMultiplier:1},{name:"CAM5 left side",start:{position:new Float32Array([7325.552,-4473.68,200]),rotation:new Float32Array([-3229.788,-748.632,518.798])},end:{position:new Float32Array([8661.427,-695.325,200]),rotation:new Float32Array([-1893.892,3029.717,518.798])},speedMultiplier:1},{name:"CAM22 front rotating",start:{position:new Float32Array([-5889.242,-7895.101,807.0224609375]),rotation:new Float32Array([-365.358,-435.5,582.775])},end:{position:new Float32Array([4805.492,-7601.44,809.42236328125]),rotation:new Float32Array([-365.358,-435.5,582.775])},speedMultiplier:1},{name:"CAM6 top-right-front",start:{position:new Float32Array([-6780.02,-2334.765,10222.003]),rotation:new Float32Array([-534.287,1029.87,640.805])},end:{position:new Float32Array([-5765.953,-4217.162,10222.003]),rotation:new Float32Array([479.778,-852.527,640.805])},speedMultiplier:1},{name:"CAM7 rear-right",start:{position:new Float32Array([-1877.286,9460.406,409.811]),rotation:new Float32Array([4.049,2756.029,466.811])},end:{position:new Float32Array([-3733.218,8939.704,421.216]),rotation:new Float32Array([-1851.883,2235.328,478.216])},speedMultiplier:1}],[{name:"CAM 1 left",start:{position:new Float32Array([-7484.467,-74.101,1847.05]),rotation:new Float32Array([-52.698,-66.7,364.453])},end:{position:new Float32Array([-7484.07,-1327.915,1847.05]),rotation:new Float32Array([-52.305,-1320.514,358.366])},speedMultiplier:1},{name:"CAM 2 sun",start:{position:new Float32Array([-7673.017,-7818.335,810]),rotation:new Float32Array([524.432,1927.873,1127])},end:{position:new Float32Array([-5971.768,-9247.609,810]),rotation:new Float32Array([2225.683,498.599,1064.422])},speedMultiplier:1},{name:"CAM 3 front",start:{position:new Float32Array([-1005.96,-6957.012,247.811]),rotation:new Float32Array([-812.29,1496.877,502.233])},end:{position:new Float32Array([567.302,-6957.012,247.811]),rotation:new Float32Array([760.972,1496.877,502.233])},speedMultiplier:1},{name:"CAM 4 sun closeup",start:{position:new Float32Array([-3075.207,-3666.483,918.937]),rotation:new Float32Array([1255.741,2147.007,352.93])},end:{position:new Float32Array([-2235,-4293,913]),rotation:new Float32Array([2095.95,1520.489,346.993])},speedMultiplier:1},{name:"CAM 5 rear top right",start:{position:new Float32Array([-3539.456,3621.527,5744.958]),rotation:new Float32Array([371.456,306.771,472.949])},end:{position:new Float32Array([-4356.865,2703.851,5715.571]),rotation:new Float32Array([-445.953,-610.906,443.559])},speedMultiplier:1}],[{name:"CAM3 left top",start:{position:new Float32Array([2005.446,-2693.32,1705.141]),rotation:new Float32Array([-58.35,-789.591,138.574])},end:{position:new Float32Array([2273.788,-2389.17,1721.237]),rotation:new Float32Array([209.992,-485.443,154.67])},speedMultiplier:1},{name:"CAM1 front closeup",start:{position:new Float32Array([-2533.513,-2698.656,73.579]),rotation:new Float32Array([-354.864,-624.051,198.243])},end:{position:new Float32Array([1386.1582,-1952.734,88.058]),rotation:new Float32Array([220.471,-1044,199])},speedMultiplier:1},{name:"CAM6 left w/ horizon",start:{position:new Float32Array([4436.104,-261.21,254.898]),rotation:new Float32Array([200.171,-431.738,150.401])},end:{position:new Float32Array([4294.794,-1996.149,272.635]),rotation:new Float32Array([58.862,-1090.961,168.138])},speedMultiplier:1},{name:"CAM2 front horizon",start:{position:new Float32Array([-446.796,-3889.132,431.116]),rotation:new Float32Array([-446.796,-217.65,154.693])},end:{position:new Float32Array([697.888,-3907.597,431]),rotation:new Float32Array([697.888,-236.114,340.048])},speedMultiplier:1},{name:"CAM4 rear right",start:{position:new Float32Array([-2375.253,925.802,146.927]),rotation:new Float32Array([-49.957,-18.69,254.764])},end:{position:new Float32Array([-2618.334,-388.599,489.511]),rotation:new Float32Array([-342.866,-818.01,294.263])},speedMultiplier:1},{name:"CAM5 top rear",start:{position:new Float32Array([539.251,-256.327,3210.38]),rotation:new Float32Array([539.251,-583.005,579.041])},end:{position:new Float32Array([-569.857,-256.327,3210.38]),rotation:new Float32Array([-569.857,-583.005,579.041])},speedMultiplier:1},{name:"CAM7 right front sun",start:{position:new Float32Array([-3837.754,-3486.7137,259.308]),rotation:new Float32Array([-811.25,-777.094,383.623])},end:{position:new Float32Array([-2635.582,-4522.342,259.308]),rotation:new Float32Array([-411.634,-1223.444,383.623])},speedMultiplier:1}]],B={translation:[5e4,25e3,5500],rotation:[-25*Math.PI/180,0,0],scale:.3,travel:-14e4,period:82200,banking:-.15*Math.PI};var V,G;!function(t){t[t.Animating=0]="Animating",t[t.Transitioning=1]="Transitioning"}(V||(V={}));class H extends m{constructor(){super(),this.lastTime=0,this.loaded=!1,this.fmGround=new r,this.fmGroundColored=new r,this.fmPlaneShadow=new r,this.fmTrees=new r,this.fmClouds=new r,this.fmPlaneUnlit=new r,this.fmPlaneLit=new r,this.fmBus=new r,this.fmPlaneTraces=new r,this.fmPlaneDistant=new r,this.fmLoader=new r,this.paletteTextures={DAY:void 0,NIGHT:void 0,SUNRISE:void 0,SUNSET:void 0},this.attribsDiffuseFP32=new Map,this.attribsDiffuseCompact=new Map,this.attribsColorFP32=new Map,this.attribsColorCompact=new Map,this.Z_NEAR=500,this.Z_FAR=28e4,this.timerCamera=0,this.CAMERA_PERIOD=87e3,this.timerBus=0,this.timerDistantPlaneRotating=0,this.BUS_PERIOD=6e4,this.BUS_X_START=-94150.047,this.BUS_X_END=105455.586,this.BUS_TRAVEL=this.BUS_X_END-this.BUS_X_START,this.BUS_Y=4612.632,this.timerCloudsRotation=0,this.CLOUDS_ROTATION_PERIOD=5e5,this.timerCloudsAnimation=0,this.CLOUDS_ANIMATION_PERIOD=15e3,this.cameraMode=f.Rotating,this.matViewInverted=v(),this.matViewInvertedTransposed=v(),this.matTemp=v(),this.cameraPosition=M(),this.cameraRotation=M(),this.tmpPosition1=[0,0,0],this.tmpPosition2=[0,0,0],this.tmpPosition3=[0,0,0],this.timeOfDay="DAY",this.config={currentPlane:0,sdfBrightness:.51,sdfContrast:8,sdfContrastMax:60,timeOfDay:this.timeOfDay,plane:"1"},this.TIMES_OF_DAY={DAY:{SKY:[203/255,215/255,199/255],GROUND:[154/255,178/255,181/255],GROUND_SHADOW:[43/255,62/255,99/255],TREES:[42/255,61/255,98/255],CLOUDS:[170/255,180/255,182/255],PLANE_SHADOW:[215/255,223/255,202/255],PLANE_BODY:[250/255,244/255,210/255],PLANE_DISTANT:[238/255,237/255,207/255],PLANE_DISTANT_TRACES:[250/255,244/255,210/255]},NIGHT:{SKY:[0,24/255,64/255],GROUND:[8/255,58/255,100/255],GROUND_SHADOW:[0,13/255,29/255],TREES:[1/255,44/255,82/255],CLOUDS:[10/255,37/255,74/255],PLANE_SHADOW:[96/255,136/255,170/255],PLANE_BODY:[157/255,187/255,212/255],PLANE_DISTANT:[54/255,82/255,122/255],PLANE_DISTANT_TRACES:[31/255,61/255,.4]},SUNRISE:{SKY:[252/255,136/255,84/255],GROUND:[120/255,50/255,66/255],GROUND_SHADOW:[85/255,24/255,34/255],TREES:[229/255,.2,77/255],CLOUDS:[252/255,110/255,85/255],PLANE_SHADOW:[193/255,161/255,109/255],PLANE_BODY:[234/255,220/255,196/255],PLANE_DISTANT:[251/255,226/255,182/255],PLANE_DISTANT_TRACES:[251/255,202/255,155/255]},SUNSET:{SKY:[170/255,60/255,91/255],GROUND:[85/255,57/255,82/255],GROUND_SHADOW:[45/255,24/255,42/255],TREES:[72/255,52/255,79/255],CLOUDS:[158/255,55/255,94/255],PLANE_SHADOW:[194/255,145/255,171/255],PLANE_BODY:[245/255,203/255,209/255],PLANE_DISTANT:[206/255,130/255,151/255],PLANE_DISTANT_TRACES:[189/255,97/255,122/255]}},this.cameraPositionInterpolator=new k,this.previousCameraReverse=!1,this.CAMERA_SPEED=1e6,this.CAMERA_MIN_DURATION=8e3/3,this.currentCamera=0,this.stateCamera=V.Animating,this.CAMERA_TRANSITION_PERIOD=1100,this.viewDir=M(),this.viewAngle=0,this.PRESETS=[{lightDir:[.30151134729385376,.30151134729385376,.9045340418815613],lightDir2:[.16222141683101654,.16222141683101654,.9733285307884216],diffuseCoef:3,diffuseCoef2:1.2,drawLoader:!0},{lightDir:[.7069963216781616,.7069963216781616,.01767490804195404],lightDir2:[.16222141683101654,.16222141683101654,.9733285307884216],diffuseCoef:3,diffuseCoef2:4,drawLoader:!0},{lightDir:[.7069963216781616,.7069963216781616,.01767490804195404],lightDir2:[.16222141683101654,.16222141683101654,.9733285307884216],diffuseCoef:3.1,diffuseCoef2:3.1,drawLoader:!1}],this.cameraPositionInterpolator.speed=this.CAMERA_SPEED,this.cameraPositionInterpolator.minDuration=this.CAMERA_MIN_DURATION,this.updateCameraInterpolator(),document.addEventListener("keypress",(t=>{"1"===t.key?(this.camera[0].start={position:new Float32Array([this.cameraPosition[0],this.cameraPosition[1],this.cameraPosition[2]]),rotation:new Float32Array([this.cameraRotation[0],this.cameraRotation[1],this.cameraRotation[2]])},this.logCamera()):"2"===t.key?(this.camera[0].end={position:new Float32Array([this.cameraPosition[0],this.cameraPosition[1],this.cameraPosition[2]]),rotation:new Float32Array([this.cameraRotation[0],this.cameraRotation[1],this.cameraRotation[2]])},this.logCamera()):"n"===t.key&&this.nextCamera()}))}setCustomCamera(t,e,i){this.customCamera=t,void 0!==e&&(this.cameraPosition=e),void 0!==i&&(this.cameraRotation=i)}resetCustomCamera(){this.customCamera=void 0}onBeforeInit(){}onAfterInit(){}onInitError(){var t,e;null===(t=document.getElementById("canvasGL"))||void 0===t||t.classList.add("hidden"),null===(e=document.getElementById("alertError"))||void 0===e||e.classList.remove("hidden")}initShaders(){this.shaderDiffuse=new _(this.gl),this.shaderDiffuseTwoColoredSdf=new F(this.gl),this.shaderColor=new O(this.gl),this.shaderCloud=new N(this.gl),this.shaderPlaneBody=new D(this.gl),this.shaderPlaneTraces=new I(this.gl);const t=this.gl;this.attribsDiffuseFP32.set(this.shaderDiffuse.rm_Vertex,[3,t.FLOAT,!1,16,0]),this.attribsDiffuseFP32.set(this.shaderDiffuse.rm_TexCoord0,[2,t.UNSIGNED_BYTE,!0,16,12]),this.attribsDiffuseCompact.set(this.shaderDiffuse.rm_Vertex,[3,t.HALF_FLOAT,!1,8,0]),this.attribsDiffuseCompact.set(this.shaderDiffuse.rm_TexCoord0,[2,t.UNSIGNED_BYTE,!0,8,6]),this.attribsColorCompact.set(this.shaderColor.rm_Vertex,[3,t.HALF_FLOAT,!1,8,0])}async loadData(){var t;const e=await Promise.all([i.load("data/textures/palette-day.webp",this.gl,this.gl.NEAREST,this.gl.NEAREST,!0),i.load("data/textures/palette-night.webp",this.gl,this.gl.NEAREST,this.gl.NEAREST,!0),i.load("data/textures/palette-sunrise.webp",this.gl,this.gl.NEAREST,this.gl.NEAREST,!0),i.load("data/textures/palette-sunset.webp",this.gl,this.gl.NEAREST,this.gl.NEAREST,!0),this.fmGround.load("data/models/ground",this.gl),this.fmGroundColored.load("data/models/ground-colored",this.gl),this.fmTrees.load("data/models/trees",this.gl),this.fmClouds.load("data/models/clouds",this.gl),this.fmBus.load("data/models/bus",this.gl),this.fmPlaneTraces.load("data/models/plane-traces",this.gl),this.fmPlaneDistant.load("data/models/plane-distant",this.gl),this.fmLoader.load("data/models/loader",this.gl)]);[this.paletteTextures.DAY,this.paletteTextures.NIGHT,this.paletteTextures.SUNRISE,this.paletteTextures.SUNSET]=e,await this.changePlane("1"),this.loaded=!0,console.log("Loaded all assets"),this.setupCanvasEvents(),null===(t=this.readyCallback)||void 0===t||t.call(this)}setupCanvasEvents(){if(!this.canvas)return;const t=this.canvas;t.addEventListener("touchstart",(e=>{const i=r=>{const o=e.touches.item(0),n=r.changedTouches.item(0);if(o&&n){const t=n.clientX-o.clientX;if(Math.abs(t)>5){const e=this.cameraPositionInterpolator.reverse;t>0?!1===e&&(this.cameraPositionInterpolator.reverse=!0,this.cameraPositionInterpolator.timer=1-this.cameraPositionInterpolator.timer):!0===e&&(this.cameraPositionInterpolator.reverse=!1,this.cameraPositionInterpolator.timer=1-this.cameraPositionInterpolator.timer)}}t.removeEventListener("touchend",i)};t.addEventListener("touchend",i)})),t.addEventListener("click",(()=>this.nextCamera()))}resizeCanvas(){void 0!==this.canvas&&super.resizeCanvas()}animate(){const t=(new Date).getTime();0!=this.lastTime&&(this.timerCamera=this.cameraMode===f.Rotating?t%this.CAMERA_PERIOD/this.CAMERA_PERIOD:.13,this.timerBus=t%this.BUS_PERIOD/this.BUS_PERIOD,this.timerDistantPlaneRotating=t%B.period/B.period,this.timerCloudsRotation=t%this.CLOUDS_ROTATION_PERIOD/this.CLOUDS_ROTATION_PERIOD,this.timerCloudsAnimation=t%this.CLOUDS_ANIMATION_PERIOD/this.CLOUDS_ANIMATION_PERIOD,this.cameraPositionInterpolator.iterate(t),1===this.cameraPositionInterpolator.timer&&(this.stateCamera===V.Animating?(this.cameraPositionInterpolator.reverse=!this.cameraPositionInterpolator.reverse,this.cameraPositionInterpolator.reset()):this.setCameraState(V.Animating))),this.lastTime=t}setCameraState(t){if(this.stateCamera===V.Animating&&t===V.Transitioning){this.currentCamera++,this.currentCamera%=this.camera.length;const t=this.camera[this.currentCamera];console.log(t.name),this.cameraPositionInterpolator.minDuration=this.CAMERA_TRANSITION_PERIOD,this.cameraPositionInterpolator.position={start:{position:[...this.cameraPositionInterpolator.cameraPosition],rotation:[...this.cameraPositionInterpolator.cameraRotation]},end:{position:[(t.end.position[0]-t.start.position[0])/2+t.start.position[0],(t.end.position[1]-t.start.position[1])/2+t.start.position[1],(t.end.position[2]-t.start.position[2])/2+t.start.position[2]],rotation:[(t.end.rotation[0]-t.start.rotation[0])/2+t.start.rotation[0],(t.end.rotation[1]-t.start.rotation[1])/2+t.start.rotation[1],(t.end.rotation[2]-t.start.rotation[2])/2+t.start.rotation[2]]}},this.previousCameraReverse=this.cameraPositionInterpolator.reverse,this.cameraPositionInterpolator.reverse=!1,this.cameraPositionInterpolator.reset()}else this.stateCamera===V.Transitioning&&t===V.Animating&&(this.updateCameraInterpolator(),this.cameraPositionInterpolator.reverse=this.previousCameraReverse,this.cameraPositionInterpolator.timer=.5);this.stateCamera=t}setCameraFOV(t){var e;e=this.gl.canvas.height>0?this.gl.canvas.width/this.gl.canvas.height:1;let i=0;if(i=this.gl.canvas.width>=this.gl.canvas.height?25*t:35*t,this.stateCamera===V.Transitioning){i+=30*Math.pow(Math.sin(this.cameraPositionInterpolator.timer*Math.PI),2)}this.setFOV(this.mProjMatrix,i,e,this.Z_NEAR,this.Z_FAR)}positionCamera(t){if(void 0!==this.customCamera)return void(this.mVMatrix=this.customCamera);const[e,i,r]=this.cameraPositionInterpolator.cameraPosition,[o,n,s]=this.cameraPositionInterpolator.cameraRotation;!function(t,e,i,r){var o,n,s,a,l,h,d,c,u,m,_=e[0],f=e[1],g=e[2],v=r[0],b=r[1],A=r[2],w=i[0],E=i[1],C=i[2];Math.abs(_-w)<p&&Math.abs(f-E)<p&&Math.abs(g-C)<p?x(t):(d=_-w,c=f-E,u=g-C,o=b*(u*=m=1/Math.hypot(d,c,u))-A*(c*=m),n=A*(d*=m)-v*u,s=v*c-b*d,(m=Math.hypot(o,n,s))?(o*=m=1/m,n*=m,s*=m):(o=0,n=0,s=0),a=c*s-u*n,l=u*o-d*s,h=d*n-c*o,(m=Math.hypot(a,l,h))?(a*=m=1/m,l*=m,h*=m):(a=0,l=0,h=0),t[0]=o,t[1]=a,t[2]=d,t[3]=0,t[4]=n,t[5]=l,t[6]=c,t[7]=0,t[8]=s,t[9]=h,t[10]=u,t[11]=0,t[12]=-(o*_+n*f+s*g),t[13]=-(a*_+l*f+h*g),t[14]=-(d*_+c*f+u*g),t[15]=1)}(this.mVMatrix,[e,i,r],[o,n,s],[0,0,1]),this.cameraPosition[0]=e,this.cameraPosition[1]=i,this.cameraPosition[2]=r,this.viewDir[0]=e-o,this.viewDir[1]=i-n,this.viewDir[2]=r-s,R(this.viewDir,this.viewDir),this.viewAngle=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(this.viewDir,[0,0,1])}drawScene(){this.loaded&&(this.positionCamera(this.timerCamera),this.setCameraFOV(1),this.gl.clearColor(this.sceneColors.SKY[0],this.sceneColors.SKY[1],this.sceneColors.SKY[2],0),this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.drawSceneObjects())}drawVignette(t){this.unbindBuffers(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.mTriangleVerticesVignette),this.gl.enableVertexAttribArray(t.rm_Vertex),this.gl.vertexAttribPointer(t.rm_Vertex,3,this.gl.FLOAT,!1,20,0),this.gl.enableVertexAttribArray(t.rm_TexCoord0),this.gl.vertexAttribPointer(t.rm_TexCoord0,2,this.gl.FLOAT,!1,20,12),this.gl.uniformMatrix4fv(t.view_proj_matrix,!1,this.getOrthoMatrix()),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}drawSceneObjects(){void 0!==this.shaderDiffuse?(this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.gl.disable(this.gl.BLEND),this.drawAirplane(),this.drawGround(),this.gl.disable(this.gl.BLEND),this.gl.depthMask(!0)):console.log("undefined shaders")}drawAirplane(){var t;void 0!==this.shaderDiffuseTwoColoredSdf&&void 0!==this.shaderDiffuse&&void 0!==this.shaderPlaneBody&&(null===(t=this.shaderDiffuse)||void 0===t||t.use(),this.setTexture2D(0,this.texturePalette,this.shaderDiffuse.sTexture),this.shaderDiffuse.drawModel(this,this.fmPlaneUnlit,0,0,0,0,0,0,1,1,1,this.attribsDiffuseCompact),this.shaderPlaneBody.use(),this.setTexture2D(0,this.texturePalette,this.shaderPlaneBody.sTexture),this.gl.uniform4f(this.shaderPlaneBody.lightDir,this.preset.lightDir[0],this.preset.lightDir[1],this.preset.lightDir[2],0),this.gl.uniform4f(this.shaderPlaneBody.lightDir2,this.preset.lightDir2[0],this.preset.lightDir2[1],this.preset.lightDir2[2],0),this.gl.uniform4f(this.shaderPlaneBody.ambient,this.sceneColors.PLANE_SHADOW[0],this.sceneColors.PLANE_SHADOW[1],this.sceneColors.PLANE_SHADOW[2],0),this.gl.uniform4f(this.shaderPlaneBody.ambient2,this.sceneColors.GROUND_SHADOW[0],this.sceneColors.GROUND_SHADOW[1],this.sceneColors.GROUND_SHADOW[2],0),this.gl.uniform4f(this.shaderPlaneBody.diffuse,this.sceneColors.PLANE_BODY[0],this.sceneColors.PLANE_BODY[1],this.sceneColors.PLANE_BODY[2],0),this.gl.uniform1f(this.shaderPlaneBody.diffuseCoef,this.preset.diffuseCoef),this.gl.uniform1f(this.shaderPlaneBody.diffuseCoef2,this.preset.diffuseCoef2),this.gl.uniform1f(this.shaderPlaneBody.diffuseExponent,124),this.shaderPlaneBody.drawModel(this,this.fmPlaneLit,0,0,0,0,0,0,1,1,1),this.shaderPlaneBody.drawModel(this,this.fmBus,this.BUS_X_START+this.timerBus*this.BUS_TRAVEL,this.BUS_Y,0,0,0,0,1,1,1),this.shaderPlaneBody.drawModel(this,this.fmBus,this.BUS_X_START+(this.timerBus+.5)%1*this.BUS_TRAVEL,this.BUS_Y,0,0,0,0,1,1,1),this.preset.drawLoader&&this.shaderPlaneBody.drawModel(this,this.fmLoader,0,0,0,0,0,0,1,1,1))}drawGround(){if(void 0===this.shaderDiffuseTwoColoredSdf||void 0===this.shaderColor||void 0===this.shaderCloud||void 0===this.shaderPlaneTraces||void 0===this.shaderDiffuse)return;const t=this.shaderDiffuseTwoColoredSdf;t.use();const e=this.config.sdfContrast+Math.max(this.viewAngle,0)*this.config.sdfContrastMax;this.gl.uniform2f(this.shaderDiffuseTwoColoredSdf.uBrightnessContrast,this.config.sdfBrightness,e),this.setTexture2D(0,this.texturePlaneShadowSdf,t.sTexture),t.setColor1(this.sceneColors.GROUND[0],this.sceneColors.GROUND[1],this.sceneColors.GROUND[2],1),t.setColor2(this.sceneColors.GROUND_SHADOW[0],this.sceneColors.GROUND_SHADOW[1],this.sceneColors.GROUND_SHADOW[2],1),t.drawModel(this,this.fmPlaneShadow,0,0,0,0,0,0,1,1,1),this.shaderColor.use(),this.shaderColor.setColor(this.sceneColors.GROUND_SHADOW[0],this.sceneColors.GROUND_SHADOW[1],this.sceneColors.GROUND_SHADOW[2],1),this.shaderColor.drawModel(this,this.fmGround,0,0,0,0,0,0,1,1,1),this.shaderColor.setColor(this.sceneColors.TREES[0],this.sceneColors.TREES[1],this.sceneColors.TREES[2],1),this.shaderColor.drawModel(this,this.fmTrees,0,0,0,0,0,0,1,1,1),this.shaderDiffuse.use(),this.setTexture2D(0,this.texturePalette,this.shaderDiffuse.sTexture),this.shaderDiffuse.drawModel(this,this.fmGroundColored,0,0,0,0,0,0,1,1,1,this.attribsDiffuseFP32),this.drawDistantPlane(0,0),this.drawDistantPlane(Math.PI,3500),this.gl.depthMask(!1),this.shaderCloud.use(),this.shaderCloud.setColor(this.sceneColors.CLOUDS[0],this.sceneColors.CLOUDS[1],this.sceneColors.CLOUDS[2],1),this.shaderCloud.setTime(Math.sin(this.timerCloudsAnimation*Math.PI*2)),this.shaderCloud.drawModel(this,this.fmClouds,-7737.234,-28334.416,0,0,0,this.timerCloudsRotation*Math.PI*2,1.15,1.15,1),this.gl.depthMask(!0),this.gl.enable(this.gl.BLEND),this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ZERO,this.gl.ONE),this.drawDistantPlaneTraces(0,0),this.drawDistantPlaneTraces(Math.PI,3500),this.gl.disable(this.gl.BLEND)}drawDistantPlane(t,e){if(void 0===this.shaderColor)return;const i=this.timerDistantPlaneRotating*Math.PI*2+t;this.calculateTransformMatricesWithBanking(Math.sin(i)*B.translation[0],Math.cos(i)*B.translation[0],B.translation[2]+e,0,0,Math.PI-i,B.scale,B.scale,B.scale,B.banking),this.shaderColor.use(),this.shaderColor.setColor(this.sceneColors.PLANE_DISTANT[0],this.sceneColors.PLANE_DISTANT[1],this.sceneColors.PLANE_DISTANT[2],1),this.shaderColor.drawModelWithoutTransform(this,this.fmPlaneDistant,this.attribsColorCompact)}drawDistantPlaneTraces(t,e){if(void 0===this.shaderPlaneTraces)return;const i=this.timerDistantPlaneRotating*Math.PI*2+t;this.calculateTransformMatricesWithBanking(Math.sin(i)*B.translation[0],Math.cos(i)*B.translation[0],B.translation[2]+e,0,0,Math.PI-i,B.scale,B.scale,B.scale,B.banking),this.shaderPlaneTraces.use(),this.shaderPlaneTraces.setColor(this.sceneColors.PLANE_DISTANT_TRACES[0],this.sceneColors.PLANE_DISTANT_TRACES[1],this.sceneColors.PLANE_DISTANT_TRACES[2],1),this.shaderPlaneTraces.drawModelWithoutTransform(this,this.fmPlaneTraces)}calculateTransformMatricesWithBanking(t,e,i,r,o,n,s,a,l,h){x(this.mMMatrix),function(t,e,i,r){var o,n,s,a,l,h,d,c,u,m,_,f,g,v,b,x,A,w,E,C,y,T,S,M,P=r[0],R=r[1],D=r[2],O=Math.hypot(P,R,D);O<p||(P*=O=1/O,R*=O,D*=O,o=Math.sin(i),s=1-(n=Math.cos(i)),a=e[0],l=e[1],h=e[2],d=e[3],c=e[4],u=e[5],m=e[6],_=e[7],f=e[8],g=e[9],v=e[10],b=e[11],x=P*P*s+n,A=R*P*s+D*o,w=D*P*s-R*o,E=P*R*s-D*o,C=R*R*s+n,y=D*R*s+P*o,T=P*D*s+R*o,S=R*D*s-P*o,M=D*D*s+n,t[0]=a*x+c*A+f*w,t[1]=l*x+u*A+g*w,t[2]=h*x+m*A+v*w,t[3]=d*x+_*A+b*w,t[4]=a*E+c*C+f*y,t[5]=l*E+u*C+g*y,t[6]=h*E+m*C+v*y,t[7]=d*E+_*C+b*y,t[8]=a*T+c*S+f*M,t[9]=l*T+u*S+g*M,t[10]=h*T+m*S+v*M,t[11]=d*T+_*S+b*M,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this.mMMatrix,this.mMMatrix,0,[1,0,0]),E(this.mMMatrix,this.mMMatrix,[t,e,i]),function(t,e,i){var r=i[0],o=i[1],n=i[2];t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this.mMMatrix,this.mMMatrix,[s,a,l]),C(this.mMMatrix,this.mMMatrix,r),y(this.mMMatrix,this.mMMatrix,o),T(this.mMMatrix,this.mMMatrix,n),C(this.mMMatrix,this.mMMatrix,h),w(this.mMVPMatrix,this.mVMatrix,this.mMMatrix),w(this.mMVPMatrix,this.mProjMatrix,this.mMVPMatrix)}changeCameraMode(){this.cameraMode===f.Fixed?this.cameraMode=f.Rotating:this.cameraMode=f.Fixed}checkGlError(t){}set ready(t){this.readyCallback=t}get sceneColors(){return this.TIMES_OF_DAY[this.config.timeOfDay]}get texturePalette(){return this.paletteTextures[this.config.timeOfDay]}async changePlane(t){const e=await Promise.all([i.load(`data/textures/plane-shadow-${t}-sdf.webp`,this.gl,this.gl.LINEAR,this.gl.LINEAR,!1),this.fmPlaneShadow.load(`data/models/plane-shadow-${t}`,this.gl),this.fmPlaneUnlit.load(`data/models/plane-unlit-${t}`,this.gl),this.fmPlaneLit.load(`data/models/plane-lit-${t}`,this.gl)]),[r]=e;void 0!==this.texturePlaneShadowSdf&&this.gl.deleteTexture(this.texturePlaneShadowSdf),this.texturePlaneShadowSdf=r,this.generateMipmaps(this.texturePlaneShadowSdf),this.config.currentPlane=+t-1,this.currentCamera=0,this.updateCameraInterpolator()}get camera(){return U[this.config.currentPlane]}get preset(){return this.PRESETS[this.config.currentPlane]}logCamera(){const t=this.camera[0];console.log(`\n        {\n            start: {\n                position: new Float32Array([${t.start.position.toString()}]),\n                rotation: new Float32Array([${t.start.rotation.toString()}])\n            },\n            end: {\n                position: new Float32Array([${t.end.position.toString()}]),\n                rotation: new Float32Array([${t.end.rotation.toString()}])\n            },\n            speedMultiplier: 1.0\n        },\n        `)}updateCameraInterpolator(){const t=this.camera[this.currentCamera];this.cameraPositionInterpolator.minDuration=this.CAMERA_MIN_DURATION,this.cameraPositionInterpolator.position=t,this.cameraPositionInterpolator.reset()}nextCamera(){this.setCameraState(V.Transitioning)}}class j{get angles(){return this._angles}set angles(t){this._angles=t,this._dirty=!0}get position(){return this._position}set position(t){this._position=t,this._dirty=!0}get viewMat(){if(this._dirty){var t=this._viewMat;x(t),C(t,t,this.angles[0]-Math.PI/2),T(t,t,this.angles[1]),y(t,t,this.angles[2]),E(t,t,[-this.position[0],-this.position[1],-this.position[2]]),this._dirty=!1}return this._viewMat}constructor(t){var e,i;this._dirty=!0,this._angles=M(),this._position=M(),this.speed=100,this.rotationSpeed=.025,this._cameraMat=v(),this._viewMat=v(),this.projectionMat=v(),this.pressedKeys=new Array,this.canvas=t.canvas,this.speed=null!==(e=t.movementSpeed)&&void 0!==e?e:100,this.rotationSpeed=null!==(i=t.rotationSpeed)&&void 0!==i?i:.025;let r,o,n=!1;window.addEventListener("keydown",(t=>this.pressedKeys[t.keyCode]=!0)),window.addEventListener("keyup",(t=>this.pressedKeys[t.keyCode]=!1)),this.canvas.addEventListener("contextmenu",(t=>t.preventDefault())),this.canvas.addEventListener("mousedown",(t=>{3===t.which&&(n=!0),r=t.pageX,o=t.pageY})),this.canvas.addEventListener("mousemove",(t=>{if(n){let e=t.pageX-r,i=t.pageY-o;r=t.pageX,o=t.pageY,this.angles[1]+=e*this.rotationSpeed,this.angles[1]<0&&(this.angles[1]+=2*Math.PI),this.angles[1]>=2*Math.PI&&(this.angles[1]-=2*Math.PI),this.angles[0]+=i*this.rotationSpeed,this.angles[0]<.5*-Math.PI&&(this.angles[0]=.5*-Math.PI),this.angles[0]>.5*Math.PI&&(this.angles[0]=.5*Math.PI),this._dirty=!0}})),this.canvas.addEventListener("mouseup",(t=>n=!1))}update(t){const e=M();let i=this.speed/1e3*t;if(this.pressedKeys[16]&&(i*=5),this.pressedKeys["W".charCodeAt(0)]&&(e[1]+=i),this.pressedKeys["S".charCodeAt(0)]&&(e[1]-=i),this.pressedKeys["A".charCodeAt(0)]&&(e[0]-=i),this.pressedKeys["D".charCodeAt(0)]&&(e[0]+=i),this.pressedKeys[32]&&(e[2]+=i),this.pressedKeys["C".charCodeAt(0)]&&(e[2]-=i),0!==e[0]||0!==e[1]||0!==e[2]){let t=this._cameraMat;x(t),C(t,t,this.angles[0]),T(t,t,this.angles[1]),A(t,t),function(t,e,i){var r=e[0],o=e[1],n=e[2],s=i[3]*r+i[7]*o+i[11]*n+i[15];s=s||1,t[0]=(i[0]*r+i[4]*o+i[8]*n+i[12])/s,t[1]=(i[1]*r+i[5]*o+i[9]*n+i[13])/s,t[2]=(i[2]*r+i[6]*o+i[10]*n+i[14])/s}(e,e,t),function(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}(this.position,this.position,e),this._dirty=!0}}}!function(t){t[t.Free=0]="Free",t[t.Predefined=1]="Predefined"}(G||(G={}));class X{constructor(t,e){this.renderer=t,this.options=e,this.matCamera=v(),this.matInvCamera=new Float32Array(16),this.vec3Eye=new Float32Array(3),this.vec3Rotation=new Float32Array(3),this.mode=G.Predefined,this.setupControls()}setupControls(){document.addEventListener("dblclick",(t=>{var e;if(this.mode===G.Predefined){this.matCamera=b(this.renderer.getViewMatrix()),this.renderer.setCustomCamera(this.matCamera),this.mode=G.Free,A(this.matInvCamera,this.matCamera),S(this.vec3Eye,this.matInvCamera),R(this.vec3Rotation,this.vec3Eye),P(this.vec3Rotation,this.vec3Rotation,-1),this.fpsCamera=null!==(e=this.fpsCamera)&&void 0!==e?e:new j(this.options),this.fpsCamera.position=this.vec3Eye;const t=e=>{this.mode===G.Free&&(this.fpsCamera.update(16),this.matCamera=this.fpsCamera.viewMat,this.renderer.setCustomCamera(this.matCamera,this.fpsCamera.position,this.fpsCamera.angles),requestAnimationFrame(t))};t()}else this.renderer.resetCustomCamera(),this.mode=G.Predefined})),document.addEventListener("keypress",(t=>{var e;if("Enter"===t.code)if(this.mode===G.Predefined){this.matCamera=b(this.renderer.getViewMatrix()),this.renderer.setCustomCamera(this.matCamera),this.mode=G.Free,A(this.matInvCamera,this.matCamera),S(this.vec3Eye,this.matInvCamera),R(this.vec3Rotation,this.vec3Eye),P(this.vec3Rotation,this.vec3Rotation,-1),this.fpsCamera=null!==(e=this.fpsCamera)&&void 0!==e?e:new j(this.options),this.fpsCamera.position=this.vec3Eye;const t=e=>{this.mode===G.Free&&(this.fpsCamera.update(16),this.matCamera=this.fpsCamera.viewMat,this.renderer.setCustomCamera(this.matCamera,this.fpsCamera.position,this.fpsCamera.angles),requestAnimationFrame(t))};t()}else this.renderer.resetCustomCamera(),this.mode=G.Predefined}))}}function z(t,e){var i=t.__state.conversionName.toString(),r=Math.round(t.r),o=Math.round(t.g),n=Math.round(t.b),s=t.a,a=Math.round(t.h),l=t.s.toFixed(1),h=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===i||"SIX_CHAR_HEX"===i){for(var d=t.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}return"CSS_RGB"===i?"rgb("+r+","+o+","+n+")":"CSS_RGBA"===i?"rgba("+r+","+o+","+n+","+s+")":"HEX"===i?"0x"+t.hex.toString(16):"RGB_ARRAY"===i?"["+r+","+o+","+n+"]":"RGBA_ARRAY"===i?"["+r+","+o+","+n+","+s+"]":"RGB_OBJ"===i?"{r:"+r+",g:"+o+",b:"+n+"}":"RGBA_OBJ"===i?"{r:"+r+",g:"+o+",b:"+n+",a:"+s+"}":"HSV_OBJ"===i?"{h:"+a+",s:"+l+",v:"+h+"}":"HSVA_OBJ"===i?"{h:"+a+",s:"+l+",v:"+h+",a:"+s+"}":"unknown format"}var W=Array.prototype.forEach,Y=Array.prototype.slice,K={BREAK:{},extend:function(t){return this.each(Y.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(i){this.isUndefined(e[i])||(t[i]=e[i])}.bind(this))}),this),t},defaults:function(t){return this.each(Y.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(i){this.isUndefined(t[i])&&(t[i]=e[i])}.bind(this))}),this),t},compose:function(){var t=Y.call(arguments);return function(){for(var e=Y.call(arguments),i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},each:function(t,e,i){if(t)if(W&&t.forEach&&t.forEach===W)t.forEach(e,i);else if(t.length===t.length+0){var r,o=void 0;for(o=0,r=t.length;o<r;o++)if(o in t&&e.call(i,t[o],o)===this.BREAK)return}else for(var n in t)if(e.call(i,t[n],n)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var r=void 0;return function(){var o=this,n=arguments;var s=i||!r;clearTimeout(r),r=setTimeout((function(){r=null,i||t.apply(o,n)}),e),s&&t.apply(o,n)}},toArray:function(t){return t.toArray?t.toArray():Y.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},$=[{litmus:K.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:z},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:z},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:z},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:z}}},{litmus:K.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:K.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:K.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(K.isNumber(t.r)&&K.isNumber(t.g)&&K.isNumber(t.b)&&K.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(K.isNumber(t.r)&&K.isNumber(t.g)&&K.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(K.isNumber(t.h)&&K.isNumber(t.s)&&K.isNumber(t.v)&&K.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(K.isNumber(t.h)&&K.isNumber(t.s)&&K.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],J=void 0,Q=void 0,q=function(){Q=!1;var t=arguments.length>1?K.toArray(arguments):arguments[0];return K.each($,(function(e){if(e.litmus(t))return K.each(e.conversions,(function(e,i){if(J=e.read(t),!1===Q&&!1!==J)return Q=J,J.conversionName=i,J.conversion=e,K.BREAK})),K.BREAK})),Q},Z=void 0,tt={hsv_to_rgb:function(t,e,i){var r=Math.floor(t/60)%6,o=t/60-Math.floor(t/60),n=i*(1-e),s=i*(1-o*e),a=i*(1-(1-o)*e),l=[[i,a,n],[s,i,n],[n,i,a],[n,s,i],[a,n,i],[i,n,s]][r];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,i){var r=Math.min(t,e,i),o=Math.max(t,e,i),n=o-r,s=void 0;return 0===o?{h:NaN,s:0,v:0}:(s=t===o?(e-i)/n:e===o?2+(i-t)/n:4+(t-e)/n,(s/=6)<0&&(s+=1),{h:360*s,s:n/o,v:o/255})},rgb_to_hex:function(t,e,i){var r=this.hex_with_component(0,2,t);return r=this.hex_with_component(r,1,e),r=this.hex_with_component(r,0,i)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,i){return i<<(Z=8*e)|t&~(255<<Z)}},et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},it=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},rt=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),ot=function t(e,i,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var n=Object.getPrototypeOf(e);return null===n?void 0:t(n,i,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0},nt=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},st=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},at=function(){function t(){if(it(this,t),this.__state=q.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return rt(t,[{key:"toString",value:function(){return z(this)}},{key:"toHexString",value:function(){return z(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function lt(t,e,i){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||at.recalculateRGB(this,e,i),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(at.recalculateRGB(this,e,i),this.__state.space="RGB"),this.__state[e]=t}})}function ht(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||at.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(at.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}at.recalculateRGB=function(t,e,i){if("HEX"===t.__state.space)t.__state[e]=tt.component_from_hex(t.__state.hex,i);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");K.extend(t.__state,tt.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},at.recalculateHSV=function(t){var e=tt.rgb_to_hsv(t.r,t.g,t.b);K.extend(t.__state,{s:e.s,v:e.v}),K.isNaN(e.h)?K.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},at.COMPONENTS=["r","g","b","h","s","v","hex","a"],lt(at.prototype,"r",2),lt(at.prototype,"g",1),lt(at.prototype,"b",0),ht(at.prototype,"h"),ht(at.prototype,"s"),ht(at.prototype,"v"),Object.defineProperty(at.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(at.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=tt.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var dt=function(){function t(e,i){it(this,t),this.initialValue=e[i],this.domElement=document.createElement("div"),this.object=e,this.property=i,this.__onChange=void 0,this.__onFinishChange=void 0}return rt(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),ct={};K.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){K.each(t,(function(t){ct[t]=e}))}));var ut=/(\d+(\.\d+)?)px/;function mt(t){if("0"===t||K.isUndefined(t))return 0;var e=t.match(ut);return K.isNull(e)?0:parseFloat(e[1])}var _t={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,i){var r=i,o=e;K.isUndefined(o)&&(o=!0),K.isUndefined(r)&&(r=!0),t.style.position="absolute",o&&(t.style.left=0,t.style.right=0),r&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,i,r){var o=i||{},n=ct[e];if(!n)throw new Error("Event type "+e+" not supported.");var s=document.createEvent(n);switch(n){case"MouseEvents":var a=o.x||o.clientX||0,l=o.y||o.clientY||0;s.initMouseEvent(e,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,a,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var h=s.initKeyboardEvent||s.initKeyEvent;K.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(e,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:s.initEvent(e,o.bubbles||!1,o.cancelable||!0)}K.defaults(s,r),t.dispatchEvent(s)},bind:function(t,e,i,r){var o=r||!1;return t.addEventListener?t.addEventListener(e,i,o):t.attachEvent&&t.attachEvent("on"+e,i),_t},unbind:function(t,e,i,r){var o=r||!1;return t.removeEventListener?t.removeEventListener(e,i,o):t.detachEvent&&t.detachEvent("on"+e,i),_t},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var i=t.className.split(/ +/);-1===i.indexOf(e)&&(i.push(e),t.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return _t},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var i=t.className.split(/ +/),r=i.indexOf(e);-1!==r&&(i.splice(r,1),t.className=i.join(" "))}else t.className=void 0;return _t},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return mt(e["border-left-width"])+mt(e["border-right-width"])+mt(e["padding-left"])+mt(e["padding-right"])+mt(e.width)},getHeight:function(t){var e=getComputedStyle(t);return mt(e["border-top-width"])+mt(e["border-bottom-width"])+mt(e["padding-top"])+mt(e["padding-bottom"])+mt(e.height)},getOffset:function(t){var e=t,i={left:0,top:0};if(e.offsetParent)do{i.left+=e.offsetLeft,i.top+=e.offsetTop,e=e.offsetParent}while(e);return i},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},ft=function(t){function e(t,i){it(this,e);var r=st(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),_t.bind(r.__checkbox,"change",(function(){o.setValue(!o.__prev)}),!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return nt(e,dt),rt(e,[{key:"setValue",value:function(t){var i=ot(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),ot(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),pt=function(t){function e(t,i,r){it(this,e);var o=st(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),n=r,s=o;if(o.__select=document.createElement("select"),K.isArray(n)){var a={};K.each(n,(function(t){a[t]=t})),n=a}return K.each(n,(function(t,e){var i=document.createElement("option");i.innerHTML=e,i.setAttribute("value",t),s.__select.appendChild(i)})),o.updateDisplay(),_t.bind(o.__select,"change",(function(){var t=this.options[this.selectedIndex].value;s.setValue(t)})),o.domElement.appendChild(o.__select),o}return nt(e,dt),rt(e,[{key:"setValue",value:function(t){var i=ot(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return _t.isActive(this.__select)?this:(this.__select.value=this.getValue(),ot(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(),gt=function(t){function e(t,i){it(this,e);var r=st(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=r;function n(){o.setValue(o.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),_t.bind(r.__input,"keyup",n),_t.bind(r.__input,"change",n),_t.bind(r.__input,"blur",(function(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())})),_t.bind(r.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return nt(e,dt),rt(e,[{key:"updateDisplay",value:function(){return _t.isActive(this.__input)||(this.__input.value=this.getValue()),ot(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function vt(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var bt=function(t){function e(t,i,r){it(this,e);var o=st(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),n=r||{};return o.__min=n.min,o.__max=n.max,o.__step=n.step,K.isUndefined(o.__step)?0===o.initialValue?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=vt(o.__impliedStep),o}return nt(e,dt),rt(e,[{key:"setValue",value:function(t){var i=t;return void 0!==this.__min&&i<this.__min?i=this.__min:void 0!==this.__max&&i>this.__max&&(i=this.__max),void 0!==this.__step&&i%this.__step!=0&&(i=Math.round(i/this.__step)*this.__step),ot(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=vt(t),this}}]),e}();var xt=function(t){function e(t,i,r){it(this,e);var o=st(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,r));o.__truncationSuspended=!1;var n=o,s=void 0;function a(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}function l(t){var e=s-t.clientY;n.setValue(n.getValue()+e*n.__impliedStep),s=t.clientY}function h(){_t.unbind(window,"mousemove",l),_t.unbind(window,"mouseup",h),a()}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),_t.bind(o.__input,"change",(function(){var t=parseFloat(n.__input.value);K.isNaN(t)||n.setValue(t)})),_t.bind(o.__input,"blur",(function(){a()})),_t.bind(o.__input,"mousedown",(function(t){_t.bind(window,"mousemove",l),_t.bind(window,"mouseup",h),s=t.clientY})),_t.bind(o.__input,"keydown",(function(t){13===t.keyCode&&(n.__truncationSuspended=!0,this.blur(),n.__truncationSuspended=!1,a())})),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return nt(e,bt),rt(e,[{key:"updateDisplay",value:function(){var t,i,r;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),i=this.__precision,r=Math.pow(10,i),Math.round(t*r)/r),ot(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function At(t,e,i,r,o){return r+(t-e)/(i-e)*(o-r)}var wt=function(t){function e(t,i,r,o,n){it(this,e);var s=st(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,{min:r,max:o,step:n})),a=s;function l(t){t.preventDefault();var e=a.__background.getBoundingClientRect();return a.setValue(At(t.clientX,e.left,e.right,a.__min,a.__max)),!1}function h(){_t.unbind(window,"mousemove",l),_t.unbind(window,"mouseup",h),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function d(t){var e=t.touches[0].clientX,i=a.__background.getBoundingClientRect();a.setValue(At(e,i.left,i.right,a.__min,a.__max))}function c(){_t.unbind(window,"touchmove",d),_t.unbind(window,"touchend",c),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),_t.bind(s.__background,"mousedown",(function(t){document.activeElement.blur(),_t.bind(window,"mousemove",l),_t.bind(window,"mouseup",h),l(t)})),_t.bind(s.__background,"touchstart",(function(t){if(1!==t.touches.length)return;_t.bind(window,"touchmove",d),_t.bind(window,"touchend",c),d(t)})),_t.addClass(s.__background,"slider"),_t.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return nt(e,bt),rt(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",ot(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),Et=function(t){function e(t,i,r){it(this,e);var o=st(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),n=o;return o.__button=document.createElement("div"),o.__button.innerHTML=void 0===r?"Fire":r,_t.bind(o.__button,"click",(function(t){return t.preventDefault(),n.fire(),!1})),_t.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return nt(e,dt),rt(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(),Ct=function(t){function e(t,i){it(this,e);var r=st(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));r.__color=new at(r.getValue()),r.__temp=new at(0);var o=r;r.domElement=document.createElement("div"),_t.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",_t.bind(r.__input,"keydown",(function(t){13===t.keyCode&&c.call(this)})),_t.bind(r.__input,"blur",c),_t.bind(r.__selector,"mousedown",(function(){_t.addClass(this,"drag").bind(window,"mouseup",(function(){_t.removeClass(o.__selector,"drag")}))})),_t.bind(r.__selector,"touchstart",(function(){_t.addClass(this,"drag").bind(window,"touchend",(function(){_t.removeClass(o.__selector,"drag")}))}));var n,s=document.createElement("div");function a(t){m(t),_t.bind(window,"mousemove",m),_t.bind(window,"touchmove",m),_t.bind(window,"mouseup",h),_t.bind(window,"touchend",h)}function l(t){_(t),_t.bind(window,"mousemove",_),_t.bind(window,"touchmove",_),_t.bind(window,"mouseup",d),_t.bind(window,"touchend",d)}function h(){_t.unbind(window,"mousemove",m),_t.unbind(window,"touchmove",m),_t.unbind(window,"mouseup",h),_t.unbind(window,"touchend",h),u()}function d(){_t.unbind(window,"mousemove",_),_t.unbind(window,"touchmove",_),_t.unbind(window,"mouseup",d),_t.unbind(window,"touchend",d),u()}function c(){var t=q(this.value);!1!==t?(o.__color.__state=t,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function u(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function m(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=o.__saturation_field.getBoundingClientRect(),i=t.touches&&t.touches[0]||t,r=i.clientX,n=i.clientY,s=(r-e.left)/(e.right-e.left),a=1-(n-e.top)/(e.bottom-e.top);return a>1?a=1:a<0&&(a=0),s>1?s=1:s<0&&(s=0),o.__color.v=a,o.__color.s=s,o.setValue(o.__color.toOriginal()),!1}function _(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=o.__hue_field.getBoundingClientRect(),i=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return i>1?i=1:i<0&&(i=0),o.__color.h=360*i,o.setValue(o.__color.toOriginal()),!1}return K.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),K.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),K.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),K.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),K.extend(s.style,{width:"100%",height:"100%",background:"none"}),Tt(s,"top","rgba(0,0,0,0)","#000"),K.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(n=r.__hue_field).style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",K.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),_t.bind(r.__saturation_field,"mousedown",a),_t.bind(r.__saturation_field,"touchstart",a),_t.bind(r.__field_knob,"mousedown",a),_t.bind(r.__field_knob,"touchstart",a),_t.bind(r.__hue_field,"mousedown",l),_t.bind(r.__hue_field,"touchstart",l),r.__saturation_field.appendChild(s),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return nt(e,dt),rt(e,[{key:"updateDisplay",value:function(){var t=q(this.getValue());if(!1!==t){var e=!1;K.each(at.COMPONENTS,(function(i){if(!K.isUndefined(t[i])&&!K.isUndefined(this.__color.__state[i])&&t[i]!==this.__color.__state[i])return e=!0,{}}),this),e&&K.extend(this.__color.__state,t)}K.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var i=this.__color.v<.5||this.__color.s>.5?255:0,r=255-i;K.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+i+","+i+","+i+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,Tt(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),K.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+i+","+i+","+i+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),e}(),yt=["-moz-","-o-","-webkit-","-ms-",""];function Tt(t,e,i,r){t.style.background="",K.each(yt,(function(o){t.style.cssText+="background: "+o+"linear-gradient("+e+", "+i+" 0%, "+r+" 100%); "}))}var St=function(t,e){var i=e||document,r=document.createElement("style");r.type="text/css",r.innerHTML=t;var o=i.getElementsByTagName("head")[0];try{o.appendChild(r)}catch(t){}},Mt=function(t,e){var i=t[e];return K.isArray(arguments[2])||K.isObject(arguments[2])?new pt(t,e,arguments[2]):K.isNumber(i)?K.isNumber(arguments[2])&&K.isNumber(arguments[3])?K.isNumber(arguments[4])?new wt(t,e,arguments[2],arguments[3],arguments[4]):new wt(t,e,arguments[2],arguments[3]):K.isNumber(arguments[4])?new xt(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new xt(t,e,{min:arguments[2],max:arguments[3]}):K.isString(i)?new gt(t,e):K.isFunction(i)?new Et(t,e,""):K.isBoolean(i)?new ft(t,e):null};var Pt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},Rt=function(){function t(){it(this,t),this.backgroundElement=document.createElement("div"),K.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),_t.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),K.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;_t.bind(this.backgroundElement,"click",(function(){e.hide()}))}return rt(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),K.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",_t.unbind(t.domElement,"webkitTransitionEnd",e),_t.unbind(t.domElement,"transitionend",e),_t.unbind(t.domElement,"oTransitionEnd",e)};_t.bind(this.domElement,"webkitTransitionEnd",e),_t.bind(this.domElement,"transitionend",e),_t.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-_t.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-_t.getHeight(this.domElement)/2+"px"}}]),t}(),Dt=function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");St(Dt);var Ot="Default",Lt=function(){try{return!!window.localStorage}catch(t){return!1}}(),Ft=void 0,Nt=!0,It=void 0,kt=!1,Ut=[],Bt=function t(e){var i=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),_t.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=K.defaults(r,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),r=K.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),K.isUndefined(r.load)?r.load={preset:Ot}:r.preset&&(r.load.preset=r.preset),K.isUndefined(r.parent)&&r.hideable&&Ut.push(this),r.resizable=K.isUndefined(r.parent)&&r.resizable,r.autoPlace&&K.isUndefined(r.scrollable)&&(r.scrollable=!0);var o,n=Lt&&"true"===localStorage.getItem(zt(this,"isLocal")),s=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return i.parent?i.getRoot().preset:r.load.preset},set:function(t){i.parent?i.getRoot().preset=t:r.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),i.revert()}},width:{get:function(){return r.width},set:function(t){r.width=t,$t(i,t)}},name:{get:function(){return r.name},set:function(t){r.name=t,a&&(a.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(e){r.closed=e,r.closed?_t.addClass(i.__ul,t.CLASS_CLOSED):_t.removeClass(i.__ul,t.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return n},set:function(t){Lt&&(n=t,t?_t.bind(window,"unload",s):_t.unbind(window,"unload",s),localStorage.setItem(zt(i,"isLocal"),t))}}}),K.isUndefined(r.parent)){if(this.closed=r.closed||!1,_t.addClass(this.domElement,t.CLASS_MAIN),_t.makeSelectable(this.domElement,!1),Lt&&n){i.useLocalStorage=!0;var l=localStorage.getItem(zt(this,"gui"));l&&(r.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,_t.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),r.closeOnTop?(_t.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(_t.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),_t.bind(this.__closeButton,"click",(function(){i.closed=!i.closed}))}else{void 0===r.closed&&(r.closed=!0);var h=document.createTextNode(r.name);_t.addClass(h,"controller-name"),a=Vt(i,h);_t.addClass(this.__ul,t.CLASS_CLOSED),_t.addClass(a,"title"),_t.bind(a,"click",(function(t){return t.preventDefault(),i.closed=!i.closed,!1})),r.closed||(this.closed=!1)}r.autoPlace&&(K.isUndefined(r.parent)&&(Nt&&(It=document.createElement("div"),_t.addClass(It,"dg"),_t.addClass(It,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(It),Nt=!1),It.appendChild(this.domElement),_t.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||$t(i,r.width)),this.__resizeHandler=function(){i.onResizeDebounced()},_t.bind(window,"resize",this.__resizeHandler),_t.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),_t.bind(this.__ul,"transitionend",this.__resizeHandler),_t.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&Kt(this),s=function(){Lt&&"true"===localStorage.getItem(zt(i,"isLocal"))&&localStorage.setItem(zt(i,"gui"),JSON.stringify(i.getSaveObject()))},this.saveToLocalStorageIfPossible=s,r.parent||((o=i.getRoot()).width+=1,K.defer((function(){o.width-=1})))};function Vt(t,e,i){var r=document.createElement("li");return e&&r.appendChild(e),i?t.__ul.insertBefore(r,i):t.__ul.appendChild(r),t.onResize(),r}function Gt(t){_t.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&_t.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function Ht(t,e){var i=t.__preset_select[t.__preset_select.selectedIndex];i.innerHTML=e?i.value+"*":i.value}function jt(t,e){var i=t.getRoot(),r=i.__rememberedObjects.indexOf(e.object);if(-1!==r){var o=i.__rememberedObjectIndecesToControllers[r];if(void 0===o&&(o={},i.__rememberedObjectIndecesToControllers[r]=o),o[e.property]=e,i.load&&i.load.remembered){var n=i.load.remembered,s=void 0;if(n[t.preset])s=n[t.preset];else{if(!n[Ot])return;s=n[Ot]}if(s[r]&&void 0!==s[r][e.property]){var a=s[r][e.property];e.initialValue=a,e.setValue(a)}}}}function Xt(t,e,i,r){if(void 0===e[i])throw new Error('Object "'+e+'" has no property "'+i+'"');var o=void 0;if(r.color)o=new Ct(e,i);else{var n=[e,i].concat(r.factoryArgs);o=Mt.apply(t,n)}r.before instanceof dt&&(r.before=r.before.__li),jt(t,o),_t.addClass(o.domElement,"c");var s=document.createElement("span");_t.addClass(s,"property-name"),s.innerHTML=o.property;var a=document.createElement("div");a.appendChild(s),a.appendChild(o.domElement);var l=Vt(t,a,r.before);return _t.addClass(l,Bt.CLASS_CONTROLLER_ROW),o instanceof Ct?_t.addClass(l,"color"):_t.addClass(l,et(o.getValue())),function(t,e,i){if(i.__li=e,i.__gui=t,K.extend(i,{options:function(e){if(arguments.length>1){var r=i.__li.nextElementSibling;return i.remove(),Xt(t,i.object,i.property,{before:r,factoryArgs:[K.toArray(arguments)]})}if(K.isArray(e)||K.isObject(e)){var o=i.__li.nextElementSibling;return i.remove(),Xt(t,i.object,i.property,{before:o,factoryArgs:[e]})}},name:function(t){return i.__li.firstElementChild.firstElementChild.innerHTML=t,i},listen:function(){return i.__gui.listen(i),i},remove:function(){return i.__gui.remove(i),i}}),i instanceof wt){var r=new xt(i.object,i.property,{min:i.__min,max:i.__max,step:i.__step});K.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=i[t],o=r[t];i[t]=r[t]=function(){var t=Array.prototype.slice.call(arguments);return o.apply(r,t),e.apply(i,t)}})),_t.addClass(e,"has-slider"),i.domElement.insertBefore(r.domElement,i.domElement.firstElementChild)}else if(i instanceof xt){var o=function(e){if(K.isNumber(i.__min)&&K.isNumber(i.__max)){var r=i.__li.firstElementChild.firstElementChild.innerHTML,o=i.__gui.__listening.indexOf(i)>-1;i.remove();var n=Xt(t,i.object,i.property,{before:i.__li.nextElementSibling,factoryArgs:[i.__min,i.__max,i.__step]});return n.name(r),o&&n.listen(),n}return e};i.min=K.compose(o,i.min),i.max=K.compose(o,i.max)}else i instanceof ft?(_t.bind(e,"click",(function(){_t.fakeEvent(i.__checkbox,"click")})),_t.bind(i.__checkbox,"click",(function(t){t.stopPropagation()}))):i instanceof Et?(_t.bind(e,"click",(function(){_t.fakeEvent(i.__button,"click")})),_t.bind(e,"mouseover",(function(){_t.addClass(i.__button,"hover")})),_t.bind(e,"mouseout",(function(){_t.removeClass(i.__button,"hover")}))):i instanceof Ct&&(_t.addClass(e,"color"),i.updateDisplay=K.compose((function(t){return e.style.borderLeftColor=i.__color.toString(),t}),i.updateDisplay),i.updateDisplay());i.setValue=K.compose((function(e){return t.getRoot().__preset_select&&i.isModified()&&Ht(t.getRoot(),!0),e}),i.setValue)}(t,l,o),t.__controllers.push(o),o}function zt(t,e){return document.location.href+"."+e}function Wt(t,e,i){var r=document.createElement("option");r.innerHTML=e,r.value=e,t.__preset_select.appendChild(r),i&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function Yt(t,e){e.style.display=t.useLocalStorage?"block":"none"}function Kt(t){var e=void 0;function i(i){return i.preventDefault(),t.width+=e-i.clientX,t.onResize(),e=i.clientX,!1}function r(){_t.removeClass(t.__closeButton,Bt.CLASS_DRAG),_t.unbind(window,"mousemove",i),_t.unbind(window,"mouseup",r)}function o(o){return o.preventDefault(),e=o.clientX,_t.addClass(t.__closeButton,Bt.CLASS_DRAG),_t.bind(window,"mousemove",i),_t.bind(window,"mouseup",r),!1}t.__resize_handle=document.createElement("div"),K.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),_t.bind(t.__resize_handle,"mousedown",o),_t.bind(t.__closeButton,"mousedown",o),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function $t(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function Jt(t,e){var i={};return K.each(t.__rememberedObjects,(function(r,o){var n={},s=t.__rememberedObjectIndecesToControllers[o];K.each(s,(function(t,i){n[i]=e?t.initialValue:t.getValue()})),i[o]=n})),i}function Qt(t){0!==t.length&&Pt.call(window,(function(){Qt(t)})),K.each(t,(function(t){t.updateDisplay()}))}Bt.toggleHide=function(){kt=!kt,K.each(Ut,(function(t){t.domElement.style.display=kt?"none":""}))},Bt.CLASS_AUTO_PLACE="a",Bt.CLASS_AUTO_PLACE_CONTAINER="ac",Bt.CLASS_MAIN="main",Bt.CLASS_CONTROLLER_ROW="cr",Bt.CLASS_TOO_TALL="taller-than-window",Bt.CLASS_CLOSED="closed",Bt.CLASS_CLOSE_BUTTON="close-button",Bt.CLASS_CLOSE_TOP="close-top",Bt.CLASS_CLOSE_BOTTOM="close-bottom",Bt.CLASS_DRAG="drag",Bt.DEFAULT_WIDTH=245,Bt.TEXT_CLOSED="Close Controls",Bt.TEXT_OPEN="Open Controls",Bt._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||Bt.toggleHide()},_t.bind(window,"keydown",Bt._keydownHandler,!1),K.extend(Bt.prototype,{add:function(t,e){return Xt(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return Xt(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;K.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&It.removeChild(this.domElement);var t=this;K.each(this.__folders,(function(e){t.removeFolder(e)})),_t.unbind(window,"keydown",Bt._keydownHandler,!1),Gt(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var i=new Bt(e);this.__folders[t]=i;var r=Vt(this,i.domElement);return _t.addClass(r,"folder"),i},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Gt(t);var e=this;K.each(t.__folders,(function(e){t.removeFolder(e)})),K.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=_t.getOffset(t.__ul).top,i=0;K.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(i+=_t.getHeight(e))})),window.innerHeight-e-20<i?(_t.addClass(t.domElement,Bt.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(_t.removeClass(t.domElement,Bt.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&K.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:K.debounce((function(){this.onResize()}),50),remember:function(){if(K.isUndefined(Ft)&&((Ft=new Rt).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;K.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&function(t){var e=t.__save_row=document.createElement("li");_t.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),_t.addClass(e,"save-row");var i=document.createElement("span");i.innerHTML="&nbsp;",_t.addClass(i,"button gears");var r=document.createElement("span");r.innerHTML="Save",_t.addClass(r,"button"),_t.addClass(r,"save");var o=document.createElement("span");o.innerHTML="New",_t.addClass(o,"button"),_t.addClass(o,"save-as");var n=document.createElement("span");n.innerHTML="Revert",_t.addClass(n,"button"),_t.addClass(n,"revert");var s=t.__preset_select=document.createElement("select");t.load&&t.load.remembered?K.each(t.load.remembered,(function(e,i){Wt(t,i,i===t.preset)})):Wt(t,Ot,!1);if(_t.bind(s,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(s),e.appendChild(i),e.appendChild(r),e.appendChild(o),e.appendChild(n),Lt){var a=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(zt(t,"isLocal"))&&l.setAttribute("checked","checked"),Yt(t,a),_t.bind(l,"change",(function(){t.useLocalStorage=!t.useLocalStorage,Yt(t,a)}))}var h=document.getElementById("dg-new-constructor");_t.bind(h,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||Ft.hide()})),_t.bind(i,"click",(function(){h.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),Ft.show(),h.focus(),h.select()})),_t.bind(r,"click",(function(){t.save()})),_t.bind(o,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),_t.bind(n,"click",(function(){t.revert()}))}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&$t(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=Jt(this)),t.folders={},K.each(this.__folders,(function(e,i){t.folders[i]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Jt(this),Ht(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[Ot]=Jt(this,!0)),this.load.remembered[t]=Jt(this),this.preset=t,Wt(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){K.each(this.__controllers,(function(e){this.getRoot().load.remembered?jt(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),K.each(this.__folders,(function(t){t.revert(t)})),t||Ht(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&Qt(this.__listening)},updateDisplay:function(){K.each(this.__controllers,(function(t){t.updateDisplay()})),K.each(this.__folders,(function(t){t.updateDisplay()}))}});var qt=Bt;let Zt;var te;te=()=>{Zt=new H,Zt.ready=()=>{!function(){var t,e;null===(t=document.getElementById("message"))||void 0===t||t.classList.add("hidden"),null===(e=document.getElementById("canvasGL"))||void 0===e||e.classList.remove("transparent"),setTimeout((()=>{var t;return null===(t=document.querySelector(".promo"))||void 0===t?void 0:t.classList.remove("transparent")}),4e3),setTimeout((()=>{var t;return null===(t=document.querySelector("#toggleFullscreen"))||void 0===t?void 0:t.classList.remove("transparent")}),1800);const i={github:()=>window.open("https://github.com/keaukraine/webgl-airport")},r=new qt;r.add(Zt.config,"timeOfDay",{Day:"DAY",Night:"NIGHT",Sunrise:"SUNRISE",Sunset:"SUNSET"}).name("Time Of Day").onChange((t=>Zt.config.timeOfDay=t)),r.add(Zt.config,"plane",{Passenger:"1","Fighter Jet":"2",Private:"3"}).name("Plane").onChange((t=>Zt.changePlane(t))),r.add(i,"github").name("Source on Github")}()},Zt.init("canvasGL",!0);const e=document.getElementById("canvasGL");new X(Zt,{canvas:e,movementSpeed:1e3,rotationSpeed:.003});const i=new t;document.getElementById("toggleFullscreen").addEventListener("click",(()=>{document.body.classList.contains("fs")?i.exitFullScreen():i.enterFullScreen(),i.addFullScreenListener((function(){i.isFullScreen()?document.body.classList.add("fs"):document.body.classList.remove("fs")}))}))},"loading"!==document.readyState?te():document.addEventListener("DOMContentLoaded",te);
//# sourceMappingURL=index.min.js.map
